<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ•°æ®ç®¡ç†ç³»ç»Ÿ - ç”¨æˆ·ç™»å½•</title>
  <link href="./src/css/layui.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      overflow: hidden;
    }
    .login-container {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      padding: 40px;
    }
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .login-header h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 10px;
      font-weight: 300;
    }
    .login-header p {
      color: #666;
      font-size: 14px;
    }
    .login-form .layui-form-item {
      margin-bottom: 20px;
    }
    .login-form .layui-input {
      height: 45px;
      line-height: 45px;
      border-radius: 8px;
      border: 1px solid #e6e6e6;
      padding-left: 15px;
    }
    .login-form .layui-input:focus {
      border-color: #16baaa;
      box-shadow: 0 0 0 2px rgba(22, 186, 170, 0.2);
    }
    .login-btn {
      width: 100%;
      height: 45px;
      line-height: 45px;
      border-radius: 8px;
      background: linear-gradient(135deg, #16baaa 0%, #1e9cbb 100%);
      border: none;
      font-size: 16px;
      margin-top: 10px;
    }
    .role-tips {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      font-size: 12px;
      color: #666;
    }
    .role-tips h4 {
      color: #333;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .demo-accounts {
      margin-top: 15px;
      font-size: 11px;
      color: #999;
      text-align: center;
    }
    .demo-accounts span {
      display: inline-block;
      margin: 0 10px;
      cursor: pointer;
      color: #16baaa;
    }
    .demo-accounts span:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-header">
      <h1>ğŸ“Š æ•°æ®ç®¡ç†ç³»ç»Ÿ</h1>
      <p>ä¼ä¸šçº§è¡¨æ ¼æ•°æ®ç®¡ç†å¹³å°</p>
    </div>
    
    <form class="layui-form login-form" lay-filter="loginForm">
      <div class="layui-form-item">
        <input type="text" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" class="layui-input" lay-verify="required" autocomplete="off">
      </div>
      
      <div class="layui-form-item">
        <input type="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " class="layui-input" lay-verify="required" autocomplete="off">
      </div>
      
      <div class="layui-form-item">
        <select name="role" lay-verify="required">
          <option value="">è¯·é€‰æ‹©ç™»å½•è§’è‰²</option>
          <option value="admin">ğŸ‘‘ è¶…çº§ç®¡ç†å‘˜</option>
          <option value="analyst">ğŸ“Š æ•°æ®åˆ†æå‘˜</option>
        </select>
      </div>
      
      <div class="layui-form-item">
        <input type="checkbox" name="remember" title="è®°ä½æˆ‘" lay-skin="primary">
      </div>
      
      <div class="layui-form-item">
        <button class="layui-btn login-btn" lay-submit lay-filter="login">ç«‹å³ç™»å½•</button>
      </div>
    </form>
    
    <div class="role-tips">
      <h4>ğŸ” è§’è‰²æƒé™è¯´æ˜ï¼š</h4>
      <p><strong>ğŸ‘‘ è¶…çº§ç®¡ç†å‘˜ï¼š</strong>æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ä»¥æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ã€å¯¼å…¥å¯¼å‡ºæ•°æ®</p>
      <p><strong>ğŸ“Š æ•°æ®åˆ†æå‘˜ï¼š</strong>åªèƒ½æŸ¥çœ‹å’Œå¯¼å‡ºæ•°æ®ï¼Œæ— æ³•ä¿®æ”¹</p>
    </div>
    
    <div class="demo-accounts">
      æ¼”ç¤ºè´¦å·ï¼š
      <span onclick="fillDemo('admin')">ç®¡ç†å‘˜ç™»å½•</span> | 
      <span onclick="fillDemo('analyst')">åˆ†æå‘˜ç™»å½•</span>
    </div>
    
    <div class="register-link" style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
      <p style="color: #666; margin-bottom: 10px;">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</p>
      <a href="register.html" style="color: #16baaa; text-decoration: none; font-weight: 500;">
        ğŸš€ ç«‹å³æ³¨å†Œ
      </a>
      <span style="margin: 0 10px; color: #ccc;">|</span>
      <a href="index.html" style="color: #666; text-decoration: none;">
        è¿”å›é¦–é¡µ
      </a>
    </div>
  </div>

  <script src="./src/layui.js"></script>
  <script>
    layui.use(['form', 'layer'], function(){
      var form = layui.form;
      var layer = layui.layer;
      
      // ç›‘å¬ç™»å½•æäº¤
      form.on('submit(login)', function(data){
        var field = data.field;
        
        // ç™»å½•éªŒè¯
        var isValid = false;
        var userInfo = {};
        
        // é¦–å…ˆæ£€æŸ¥æ³¨å†Œç”¨æˆ·
        var registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        var registeredUser = registeredUsers.find(user => 
          user.username === field.username && 
          user.password === field.password && 
          user.role === field.role &&
          user.status === 'active'
        );
        
        if(registeredUser) {
          isValid = true;
          userInfo = {
            username: registeredUser.username,
            realname: registeredUser.realname,
            email: registeredUser.email,
            role: registeredUser.role,
            roleName: registeredUser.role === 'admin' ? 'è¶…çº§ç®¡ç†å‘˜' : 'æ•°æ®åˆ†æå‘˜',
            permissions: registeredUser.role === 'admin' ? 
              ['view', 'edit', 'delete', 'import', 'export', 'manage'] : 
              ['view', 'export']
          };
          
          // è®°å½•ç™»å½•å†å²
          registeredUser.loginHistory.push({
            time: new Date().toLocaleString(),
            ip: 'æœ¬åœ°ç™»å½•'
          });
          localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        }
        // æ¼”ç¤ºè´¦å·éªŒè¯ï¼ˆä¿æŒå…¼å®¹æ€§ï¼‰
        else if(field.username === 'admin' && field.password === '123456' && field.role === 'admin') {
          isValid = true;
          userInfo = {
            username: 'admin',
            role: 'admin',
            roleName: 'è¶…çº§ç®¡ç†å‘˜',
            permissions: ['view', 'edit', 'delete', 'import', 'export', 'manage']
          };
        } else if(field.username === 'analyst' && field.password === '123456' && field.role === 'analyst') {
          isValid = true;
          userInfo = {
            username: 'analyst',
            role: 'analyst',
            roleName: 'æ•°æ®åˆ†æå‘˜',
            permissions: ['view', 'export']
          };
        }
        
        if(isValid) {
          // è°ƒç”¨åç«¯APIè·å–JWTä»¤ç‰Œ
          fetch('/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              username: field.username,
              password: field.password,
              role: field.role
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // ä¿å­˜å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯å’Œä»¤ç‰Œ
              var completeUserInfo = {
                ...userInfo,
                ...data.user,
                token: data.token
              };
              
              localStorage.setItem('currentUser', JSON.stringify(completeUserInfo));
              localStorage.setItem('token', data.token);
              
              layer.msg('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...', {icon: 1, time: 800}, function(){
                window.location.href = 'dashboard.html';
              });
            } else {
              layer.msg('åç«¯è®¤è¯å¤±è´¥: ' + data.error, {icon: 2});
              // å¦‚æœåç«¯è®¤è¯å¤±è´¥ï¼Œä»ç„¶ä½¿ç”¨å‰ç«¯è®¤è¯
              localStorage.setItem('currentUser', JSON.stringify(userInfo));
              window.location.href = 'dashboard.html';
            }
          })
          .catch(error => {
            console.warn('åç«¯APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨å‰ç«¯è®¤è¯:', error);
            // å¦‚æœåç«¯ä¸å¯ç”¨ï¼Œä»ç„¶ä½¿ç”¨å‰ç«¯è®¤è¯
            localStorage.setItem('currentUser', JSON.stringify(userInfo));
            layer.msg('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...', {icon: 1, time: 800}, function(){
              window.location.href = 'dashboard.html';
            });
          });
        } else {
          layer.msg('ç”¨æˆ·åã€å¯†ç æˆ–è§’è‰²ä¸æ­£ç¡®ï¼', {icon: 2});
        }
        
        return false;
      });
    });
    
    // å¿«é€Ÿå¡«å……æ¼”ç¤ºè´¦å·
    function fillDemo(type) {
      if(type === 'admin') {
        document.querySelector('input[name="username"]').value = 'admin';
        document.querySelector('input[name="password"]').value = '123456';
        document.querySelector('select[name="role"]').value = 'admin';
      } else if(type === 'analyst') {
        document.querySelector('input[name="username"]').value = 'analyst';
        document.querySelector('input[name="password"]').value = '123456';
        document.querySelector('select[name="role"]').value = 'analyst';
      }
      layui.form.render('select');
    }
  </script>
</body>
</html> 