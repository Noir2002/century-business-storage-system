{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "C:\\Users\\xiaol\\Desktop\\layui\\.wrangler\\tmp\\deploy-ZiY3ng",
  "sourcesContent": ["// \u7B80\u5316\u7684Cloudflare Workers - \u4E13\u6CE8\u4E8EExcel\u6587\u4EF6\u4E0A\u4F20\u5230R2\r\n// \u8F7B\u91CF\u7EA7\u5185\u5B58\u7F13\u5B58\uFF1A\u7528\u4E8E\u5728\u540C\u4E00 Worker \u5B9E\u4F8B\u4E2D\u6682\u5B58\u201C\u5BBD\u8868\u201D\u6570\u636E\uFF0C\u4FBF\u4E8E\u4E0A\u4F20\u540E\u5373\u65F6\u5237\u65B0\r\nlet wideTableCache = [];\r\nlet recordsCache = [];\r\nlet tmallWideCache = [];\r\nconst WIDE_TABLE_R2_KEY = 'wide/latest.json';\r\nconst RECORDS_R2_KEY = 'records/latest.json';\r\nconst TMALL_WIDE_R2_KEY = 'tmall/wide.json';\r\n\r\n// \u5DE5\u5177\uFF1A\u83B7\u53D6\u65E5\u671F\u952E\uFF08YYYY-MM-DD\uFF09\r\nfunction getDateKeysFromRow(row) {\r\n  return Object.keys(row || {}).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k));\r\n}\r\nfunction formatYMD(d) {\r\n  const y = d.getFullYear();\r\n  const m = String(d.getMonth()+1).padStart(2,'0');\r\n  const day = String(d.getDate()).padStart(2,'0');\r\n  return `${y}-${m}-${day}`;\r\n}\r\n// \u5C06\u8D85\u8FC7\u6700\u8FD1N\u5929\u7684\u6570\u636E\u4ECE\u5BBD\u8868\u5F52\u6863\u5230\u884C\u8BB0\u5F55\r\nasync function archiveOldDatesToRecords(env, keepDays = 5) {\r\n  // \u5173\u95ED\u81EA\u52A8\u5F52\u6863\uFF1A\u82E5\u672A\u663E\u5F0F\u914D\u7F6E ARCHIVE_KEEP_DAYS\uFF0C\u5219\u4E0D\u505A\u5F52\u6863\r\n  const configured = env && env.ARCHIVE_KEEP_DAYS !== undefined && env.ARCHIVE_KEEP_DAYS !== null;\r\n  const effectiveKeepDays = configured ? parseInt(env.ARCHIVE_KEEP_DAYS) || 0 : 0;\r\n  if (effectiveKeepDays <= 0) return;\r\n  keepDays = effectiveKeepDays;\r\n  if (!Array.isArray(wideTableCache) || wideTableCache.length === 0) return;\r\n  const today = new Date();\r\n  const keepSet = new Set(Array.from({length: keepDays}, (_,i)=>{\r\n    const d = new Date(today); d.setDate(today.getDate()-i); return formatYMD(d);\r\n  }));\r\n  let archived = [];\r\n  wideTableCache.forEach(row => {\r\n    const dateKeys = getDateKeysFromRow(row);\r\n    dateKeys.forEach(k => {\r\n      if (!keepSet.has(k)) {\r\n        const stock = parseInt(row[k]||0) || 0;\r\n        const rec = {\r\n          id: Date.now() + Math.floor(Math.random()*1e6),\r\n          SKU: row.SKU || '',\r\n          '\u4EA7\u54C1\u4E2D\u6587\u540D': row['\u4EA7\u54C1\u4E2D\u6587\u540D'] || '',\r\n          '\u7F51\u9875\u94FE\u63A5': row['\u7F51\u9875\u94FE\u63A5'] || '',\r\n          '\u521D\u59CB\u5E93\u5B58': row['\u521D\u59CB\u5E93\u5B58'] || 0,\r\n          '\u65E5\u671F': `${k} 00:00`,\r\n          '\u5E93\u5B58': stock,\r\n          '\u9500\u91CF': row[k + '_\u9500\u91CF'] != null ? parseInt(row[k + '_\u9500\u91CF']) || 0 : 0\r\n        };\r\n        archived.push(rec);\r\n        delete row[k];\r\n        delete row[k + '_\u9500\u91CF'];\r\n      }\r\n    });\r\n  });\r\n  if (archived.length) {\r\n    if (!Array.isArray(recordsCache)) recordsCache = [];\r\n    // \u65B0\u5F52\u6863\u7684\u653E\u5230\u6700\u524D\u9762\r\n    recordsCache = [...archived, ...recordsCache];\r\n    // \u6301\u4E45\u5316\u4E24\u4EFD\u6570\u636E\r\n    if (env && env.R2_BUCKET) {\r\n      try {\r\n        await env.R2_BUCKET.put(WIDE_TABLE_R2_KEY, JSON.stringify(wideTableCache), { httpMetadata: { contentType: 'application/json' } });\r\n        await env.R2_BUCKET.put(RECORDS_R2_KEY, JSON.stringify(recordsCache), { httpMetadata: { contentType: 'application/json' } });\r\n      } catch (e) { console.warn('\u5F52\u6863\u6301\u4E45\u5316\u5931\u8D25:', e); }\r\n    }\r\n  }\r\n}\r\n\r\n// \u8BA1\u7B97\u9500\u91CF\uFF1A\u6839\u636E\u201C\u521D\u59CB\u5E93\u5B58\u201D\u548C\u5404\u65E5\u671F\u5E93\u5B58\u5217\u8BA1\u7B97 \u201C\u65E5\u671F_\u9500\u91CF\u201D \u5217\r\nfunction computeSalesForWideTableRows(rows) {\r\n  if (!Array.isArray(rows)) return rows;\r\n  return rows.map(row => {\r\n    const dateKeys = getDateKeysFromRow(row).sort();\r\n    if (dateKeys.length === 0) return row;\r\n    const initial = parseInt(row['\u521D\u59CB\u5E93\u5B58'] || 0) || 0;\r\n    let prevStock = initial;\r\n    dateKeys.forEach((k, idx) => {\r\n      const currStock = parseInt(row[k] || 0) || 0;\r\n      let sales = 0;\r\n      if (idx === 0) {\r\n        sales = Math.max(0, prevStock - currStock);\r\n      } else {\r\n        sales = Math.max(0, prevStock - currStock);\r\n      }\r\n      row[k + '_\u9500\u91CF'] = sales;\r\n      prevStock = currStock;\r\n    });\r\n    return row;\r\n  });\r\n}\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    const url = new URL(request.url);\r\n    const path = url.pathname;\r\n    const method = request.method;\r\n\r\n    // CORS\u5934\r\n    const corsHeaders = {\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    };\r\n\r\n    // \u5904\u7406CORS\u9884\u68C0\u8BF7\u6C42\r\n    if (method === 'OPTIONS') {\r\n      return new Response(null, {\r\n        status: 200,\r\n        headers: corsHeaders\r\n      });\r\n    }\r\n\r\n    try {\r\n      // \u8DEF\u7531\u5904\u7406\uFF1A\u4EC5\u5F53 /api/ \u524D\u7F00\u65F6\u8FDB\u5165 API \u5206\u53D1\r\n      if (path.startsWith('/api/')) {\r\n        if (path === '/api/health' && (method === 'GET' || method === 'HEAD')) {\r\n          return Response.json({ success: true, service: 'worker', time: new Date().toISOString() }, { headers: corsHeaders });\r\n        } else if (path === '/api/files/upload' && method === 'POST') {\r\n          return await handleExcelUpload(request, env, corsHeaders);\r\n        } else if (path === '/api/package/upload' && method === 'POST') {\r\n          return await handlePackageUpload(request, env, corsHeaders);\r\n        } else if (path === '/api/files' && method === 'GET') {\r\n          return await handleFilesList(request, env, corsHeaders);\r\n        } else if (path === '/api/package/files' && method === 'GET') {\r\n          return await handlePackageFilesList(request, env, corsHeaders);\r\n        } else if (path === '/api/files/presigned-url' && method === 'POST') {\r\n          return await handlePresignedUrl(request, env, corsHeaders);\r\n        } else if (path === '/api/files/parse' && method === 'POST') {\r\n          return await handleExcelParse(request, env, corsHeaders);\r\n        } else if (path.startsWith('/api/files/') && method === 'GET' && path.endsWith('/download')) {\r\n          return await handleFileDownload(request, env, path, corsHeaders);\r\n        } else if (path.startsWith('/api/package/') && method === 'GET' && path.endsWith('/download')) {\r\n          return await handlePackageFileDownload(request, env, path, corsHeaders);\r\n        } else if (path.startsWith('/api/files/') && method === 'GET' && path.endsWith('/analyze')) {\r\n          return await handleFileAnalyze(request, env, path, corsHeaders);\r\n        } else if (path.startsWith('/api/inventory/')) {\r\n          return await handleInventoryData(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/analytics/')) {\r\n          return await handleAnalyticsData(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/localdb/')) {\r\n          return await handleLocalDB(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/tmall-orders/')) {\r\n          return await handleTmallOrders(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/r2/')) {\r\n          return await handleR2Routes(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/package-sync/')) {\r\n          return await handlePackageSync(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/listing/') || path.startsWith('/api/delisting/')) {\r\n          return await handleListingManagement(request, env, path, method, corsHeaders);\r\n        } else if (path.startsWith('/api/reorganize/')) {\r\n          return await handleReorganization(request, env, path, method, corsHeaders);\r\n        } else {\r\n          return new Response('Not Found', { status: 404, headers: corsHeaders });\r\n        }\r\n      }\r\n\r\n      // \u975E /api/ \u7684\u8BF7\u6C42\uFF0C\u4EA4\u7ED9\u9759\u6001\u8D44\u4EA7\uFF08Sites\uFF09\uFF0C\u540C\u65F6\u8865\u5145CORS\u54CD\u5E94\u5934\r\n      if (env.ASSETS && env.ASSETS.fetch) {\r\n        const resp = await env.ASSETS.fetch(request);\r\n        const headers = new Headers(resp.headers);\r\n        headers.set('Access-Control-Allow-Origin', '*');\r\n        headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\r\n        headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\r\n        return new Response(resp.body, { status: resp.status, statusText: resp.statusText, headers });\r\n      }\r\n\r\n      // \u515C\u5E95\r\n      return new Response('Not Found', { status: 404, headers: corsHeaders });\r\n    } catch (error) {\r\n      console.error('Worker Error:', error);\r\n      return new Response(JSON.stringify({ \r\n        success: false, \r\n        error: error.message \r\n      }), {\r\n        status: 500,\r\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\n// \u5904\u7406\u6253\u5305\u7CFB\u7EDF\u6587\u4EF6\u4E0A\u4F20\uFF08\u652F\u6301\u6240\u6709\u6587\u4EF6\u7C7B\u578B\uFF09\r\nasync function handlePackageUpload(request, env, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u6253\u5305\u7CFB\u7EDF\u6587\u4EF6\u4E0A\u4F20...');\r\n  \r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file');\r\n    const description = formData.get('description') || '';\r\n    \r\n    if (!file) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u6CA1\u6709\u4E0A\u4F20\u6587\u4EF6'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u751F\u6210\u6587\u4EF6\u540D\r\n    const timestamp = Date.now();\r\n    const randomSuffix = Math.round(Math.random() * 1E9);\r\n    const fileExtension = getFileExtension(file.name);\r\n    const fileName = `${timestamp}-${randomSuffix}.${fileExtension}`;\r\n    const filePath = `package/${fileName}`;\r\n    \r\n    console.log(`\uD83D\uDCC1 \u4E0A\u4F20\u6587\u4EF6\u8DEF\u5F84: ${filePath}`);\r\n\r\n    // \u4E0A\u4F20\u5230R2\r\n    if (env.R2_BUCKET) {\r\n      console.log('\uD83D\uDCE6 \u4F7F\u7528R2 Bucket\u4E0A\u4F20...');\r\n      await env.R2_BUCKET.put(filePath, file.stream(), {\r\n        httpMetadata: {\r\n          contentType: file.type || 'application/octet-stream',\r\n        },\r\n        customMetadata: {\r\n          originalName: file.name,\r\n          uploadTime: new Date().toISOString(),\r\n          description: description\r\n        }\r\n      });\r\n    } else {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n    \r\n    // \u6784\u5EFA\u6587\u4EF6\u4FE1\u606F\r\n    const fileInfo = {\r\n      id: timestamp,\r\n      originalName: file.name,\r\n      fileName: fileName,\r\n      size: file.size,\r\n      uploadTime: new Date().toISOString(),\r\n      uploadedBy: 'package-system',\r\n      description: description,\r\n      r2Path: filePath,\r\n      publicUrl: `https://23441d4f7734b84186c4c20ddefef8e7.r2.cloudflarestorage.com/century-business-system/${filePath}`\r\n    };\r\n\r\n    console.log('\u2705 \u6253\u5305\u7CFB\u7EDF\u6587\u4EF6\u4E0A\u4F20\u6210\u529F:', fileName);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      message: '\u6587\u4EF6\u4E0A\u4F20\u6210\u529F',\r\n      file: fileInfo\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u6253\u5305\u7CFB\u7EDF\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u5904\u7406Excel\u6587\u4EF6\u4E0A\u4F20\r\nasync function handleExcelUpload(request, env, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406Excel\u6587\u4EF6\u4E0A\u4F20...');\r\n  \r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file');\r\n    const description = formData.get('description') || '';\r\n    \r\n    if (!file) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u6CA1\u6709\u4E0A\u4F20\u6587\u4EF6'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u9A8C\u8BC1\u6587\u4EF6\u7C7B\u578B\r\n    if (!isExcelFile(file)) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u53EA\u652F\u6301Excel\u6587\u4EF6(.xlsx, .xls)'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u751F\u6210\u6587\u4EF6\u540D\r\n    const timestamp = Date.now();\r\n    const randomSuffix = Math.round(Math.random() * 1E9);\r\n    const fileExtension = getFileExtension(file.name);\r\n    const fileName = `${timestamp}-${randomSuffix}.${fileExtension}`;\r\n    const filePath = `arc/${fileName}`;\r\n    \r\n    console.log(`\uD83D\uDCC1 \u4E0A\u4F20\u6587\u4EF6\u8DEF\u5F84: ${filePath}`);\r\n\r\n    // \u4E0A\u4F20\u5230R2\r\n    if (env.R2_BUCKET) {\r\n      console.log('\uD83D\uDCE6 \u4F7F\u7528R2 Bucket\u4E0A\u4F20...');\r\n      await env.R2_BUCKET.put(filePath, file.stream(), {\r\n        httpMetadata: {\r\n          contentType: file.type || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n        },\r\n        customMetadata: {\r\n          originalName: file.name,\r\n          uploadTime: new Date().toISOString(),\r\n          description: description\r\n        }\r\n      });\r\n    } else {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n    \r\n    // \u6784\u5EFA\u6587\u4EF6\u4FE1\u606F\r\n    const fileInfo = {\r\n      id: timestamp,\r\n      originalName: file.name,\r\n      fileName: fileName,\r\n      size: file.size,\r\n      uploadTime: new Date().toISOString(),\r\n      uploadedBy: 'admin',\r\n      description: description,\r\n      r2Path: filePath,\r\n      publicUrl: `https://23441d4f7734b84186c4c20ddefef8e7.r2.cloudflarestorage.com/century-business-system/${filePath}`\r\n    };\r\n    \r\n    console.log('\u2705 \u6587\u4EF6\u4E0A\u4F20\u6210\u529F:', fileInfo);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      message: '\u6587\u4EF6\u4E0A\u4F20\u6210\u529F',\r\n      file: fileInfo\r\n    }, { headers: corsHeaders });\r\n    \r\n  } catch (error) {\r\n    console.error('\u274C \u6587\u4EF6\u4E0A\u4F20\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: `\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25: ${error.message}`\r\n    }, { \r\n      status: 500,\r\n      headers: corsHeaders \r\n    });\r\n  }\r\n}\r\n\r\n// \u83B7\u53D6\u6253\u5305\u6587\u4EF6\u5217\u8868\r\nasync function handlePackageFilesList(request, env, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u83B7\u53D6\u6253\u5305\u6587\u4EF6\u5217\u8868...');\r\n\r\n  try {\r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    // \u5217\u51FA package/ \u524D\u7F00\u4E0B\u7684\u6240\u6709\u6587\u4EF6\r\n    const list = await env.R2_BUCKET.list({ prefix: 'package/' });\r\n    \r\n    const files = [];\r\n    for (const obj of list.objects) {\r\n      try {\r\n        // \u83B7\u53D6\u6587\u4EF6\u5143\u6570\u636E\r\n        const fileObj = await env.R2_BUCKET.get(obj.key);\r\n        if (fileObj) {\r\n          files.push({\r\n            id: extractIdFromFileName(obj.key),\r\n            originalName: fileObj.customMetadata?.originalName || obj.key.split('/').pop(),\r\n            fileName: obj.key.split('/').pop(),\r\n            size: obj.size,\r\n            uploadTime: fileObj.customMetadata?.uploadTime || obj.uploaded.toISOString(),\r\n            description: fileObj.customMetadata?.description || '',\r\n            r2Path: obj.key,\r\n            publicUrl: `https://23441d4f7734b84186c4c20ddefef8e7.r2.cloudflarestorage.com/century-business-system/${obj.key}`\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.warn('\u83B7\u53D6\u6587\u4EF6\u5143\u6570\u636E\u5931\u8D25:', obj.key, err.message);\r\n      }\r\n    }\r\n\r\n    console.log(`\u2705 \u627E\u5230 ${files.length} \u4E2A\u6253\u5305\u6587\u4EF6`);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      files: files\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u83B7\u53D6\u6253\u5305\u6587\u4EF6\u5217\u8868\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u83B7\u53D6\u6587\u4EF6\u5217\u8868\r\nasync function handleFilesList(request, env, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u83B7\u53D6\u6587\u4EF6\u5217\u8868...');\r\n  \r\n  try {\r\n    if (env.R2_BUCKET) {\r\n      const objects = await env.R2_BUCKET.list({ prefix: 'arc/' });\r\n      const files = objects.objects.map((obj, index) => ({\r\n        id: index + 1,\r\n        originalName: obj.customMetadata?.originalName || obj.key.replace('arc/', ''),\r\n        fileName: obj.key.replace('arc/', ''),\r\n        size: obj.size || 0,\r\n        uploadTime: obj.customMetadata?.uploadTime || obj.uploaded || new Date().toISOString(),\r\n        uploadedBy: 'admin',\r\n        description: obj.customMetadata?.description || '',\r\n        r2Path: obj.key,\r\n        publicUrl: `https://23441d4f7734b84186c4c20ddefef8e7.r2.cloudflarestorage.com/century-business-system/${obj.key}`\r\n      }));\r\n      \r\n      console.log(`\u2705 \u627E\u5230 ${files.length} \u4E2A\u6587\u4EF6`);\r\n      \r\n      return Response.json({ \r\n        success: true, \r\n        files: files \r\n      }, { headers: corsHeaders });\r\n    } else {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n  } catch (error) {\r\n    console.error('\u274C \u83B7\u53D6\u6587\u4EF6\u5217\u8868\u5931\u8D25:', error);\r\n    \r\n    // \u56DE\u9000\u5230\u7A7A\u5217\u8868\r\n    return Response.json({ \r\n      success: true, \r\n      files: [],\r\n      message: '\u6587\u4EF6\u5217\u8868\u4E3A\u7A7A\u6216\u83B7\u53D6\u5931\u8D25'\r\n    }, { headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u9A8C\u8BC1Excel\u6587\u4EF6\r\nfunction isExcelFile(file) {\r\n  const allowedTypes = [\r\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx\r\n    'application/vnd.ms-excel', // .xls\r\n    'application/excel',\r\n    'application/x-excel'\r\n  ];\r\n  \r\n  const allowedExtensions = ['.xlsx', '.xls'];\r\n  const fileName = file.name.toLowerCase();\r\n  \r\n  return allowedTypes.includes(file.type) || \r\n         allowedExtensions.some(ext => fileName.endsWith(ext));\r\n}\r\n\r\n// \u76F4\u63A5\u901A\u8FC7Workers\u5904\u7406\u6587\u4EF6\u4E0A\u4F20 - \u89E3\u51B3CORS\u95EE\u9898\u7684\u6700\u7B80\u5355\u65B9\u6CD5\r\nasync function handlePresignedUrl(request, env, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u6587\u4EF6\u4E0A\u4F20\u8BF7\u6C42...');\r\n  \r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file');\r\n    const originalFileName = formData.get('fileName') || file.name;\r\n    \r\n    if (!file) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u6CA1\u6709\u4E0A\u4F20\u6587\u4EF6'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u9A8C\u8BC1\u6587\u4EF6\u7C7B\u578B\r\n    if (!isExcelFile(file)) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u53EA\u652F\u6301Excel\u6587\u4EF6(.xlsx, .xls)'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u751F\u6210\u6587\u4EF6\u8DEF\u5F84\r\n    const timestamp = Date.now();\r\n    const randomSuffix = Math.round(Math.random() * 1E9);\r\n    const fileExtension = getFileExtension(originalFileName);\r\n    const newFileName = `${timestamp}-${randomSuffix}.${fileExtension}`;\r\n    const filePath = `arc/${newFileName}`;\r\n    \r\n    console.log(`\uD83D\uDCC1 \u4E0A\u4F20\u6587\u4EF6\u5230: ${filePath}`);\r\n\r\n    if (env.R2_BUCKET) {\r\n      // 1. \u5148\u89E3\u6790Excel\u6587\u4EF6\u5185\u5BB9\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      const excelData = parseExcelData(arrayBuffer);\r\n      \r\n      // 2. \u5B58\u50A8\u89E3\u6790\u540E\u7684\u6570\u636E\u5230\u672C\u5730\u7F13\u5B58\uFF08\u4F7F\u7528KV\u6216\u8005\u7B80\u5355\u5B58\u50A8\uFF09\r\n      const dataKey = `excel_data_${timestamp}`;\r\n      // \u8FD9\u91CC\u5E94\u8BE5\u5B58\u50A8\u5230KV\uFF0C\u4F46\u6682\u65F6\u6A21\u62DF\u5B58\u50A8\r\n      \r\n      // 3. \u7136\u540E\u4E0A\u4F20\u539F\u6587\u4EF6\u5230R2\r\n      await env.R2_BUCKET.put(filePath, file.stream(), {\r\n        httpMetadata: {\r\n          contentType: file.type || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n        },\r\n        customMetadata: {\r\n          originalName: originalFileName,\r\n          uploadTime: new Date().toISOString(),\r\n          dataKey: dataKey,\r\n          parsedRows: excelData.length\r\n        }\r\n      });\r\n      \r\n      return Response.json({\r\n        success: true,\r\n        filePath: filePath,\r\n        newFileName: newFileName,\r\n        originalName: originalFileName,\r\n        size: file.size,\r\n        uploadTime: new Date().toISOString(),\r\n        publicUrl: `https://23441d4f7734b84186c4c20ddefef8e7.r2.cloudflarestorage.com/century-business-system/${filePath}`\r\n      }, { headers: corsHeaders });\r\n    } else {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('\u274C \u6587\u4EF6\u4E0A\u4F20\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: `\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25: ${error.message}`\r\n    }, { \r\n      status: 500,\r\n      headers: corsHeaders \r\n    });\r\n  }\r\n}\r\n\r\n// \u9A8C\u8BC1Excel\u6587\u4EF6\u7C7B\u578B\r\nfunction isExcelFileType(fileType, fileName) {\r\n  const allowedTypes = [\r\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx\r\n    'application/vnd.ms-excel', // .xls\r\n    'application/excel',\r\n    'application/x-excel'\r\n  ];\r\n  \r\n  const allowedExtensions = ['.xlsx', '.xls'];\r\n  const fileNameLower = fileName.toLowerCase();\r\n  \r\n  return allowedTypes.includes(fileType) || \r\n         allowedExtensions.some(ext => fileNameLower.endsWith(ext));\r\n}\r\n\r\n// Excel\u6587\u4EF6\u89E3\u6790API\r\nasync function handleExcelParse(request, env, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u89E3\u6790Excel\u6587\u4EF6...');\r\n  \r\n  try {\r\n    const body = await request.json();\r\n    const { filePath } = body;\r\n    \r\n    if (!filePath) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u6587\u4EF6\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u4ECER2\u83B7\u53D6\u6587\u4EF6\r\n    if (env.R2_BUCKET) {\r\n      const object = await env.R2_BUCKET.get(filePath);\r\n      \r\n      if (!object) {\r\n        return Response.json({\r\n          success: false,\r\n          error: '\u6587\u4EF6\u4E0D\u5B58\u5728'\r\n        }, { headers: corsHeaders });\r\n      }\r\n\r\n      // \u6A21\u62DFExcel\u89E3\u6790 - \u5728\u5B9E\u9645\u73AF\u5883\u4E2D\u53EF\u4EE5\u4F7F\u7528XLSX\u5E93\r\n      const mockData = generateMockInventoryData();\r\n      \r\n      // \u5B58\u50A8\u89E3\u6790\u540E\u7684\u6570\u636E\u5230\u6A21\u62DF\u6570\u636E\u5E93\r\n      const dataKey = `excel_data_${Date.now()}`;\r\n      \r\n      return Response.json({\r\n        success: true,\r\n        dataKey: dataKey,\r\n        rows: mockData.length,\r\n        columns: Object.keys(mockData[0] || {}).length,\r\n        preview: mockData.slice(0, 5), // \u524D5\u884C\u9884\u89C8\r\n        message: 'Excel\u6587\u4EF6\u89E3\u6790\u6210\u529F'\r\n      }, { headers: corsHeaders });\r\n    } else {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('\u274C Excel\u89E3\u6790\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: `Excel\u89E3\u6790\u5931\u8D25: ${error.message}`\r\n    }, { \r\n      status: 500,\r\n      headers: corsHeaders \r\n    });\r\n  }\r\n}\r\n\r\n// \u5E93\u5B58\u6570\u636EAPI\r\nasync function handleInventoryData(request, env, path, method, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u5E93\u5B58\u6570\u636E\u8BF7\u6C42:', path);\r\n  \r\n  if (path === '/api/inventory/data' && method === 'GET') {\r\n    // \u83B7\u53D6\u5E93\u5B58\u6570\u636E - \u4F7F\u7528\u771F\u5B9E\u6570\u636E\r\n    const salesData = await generateRealSalesData(env);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      data: salesData,\r\n      total: salesData.length,\r\n      message: '\u5E93\u5B58\u6570\u636E\u83B7\u53D6\u6210\u529F'\r\n    }, { headers: corsHeaders });\r\n  } else if (path === '/api/inventory/summary' && method === 'GET') {\r\n    // \u83B7\u53D6\u5E93\u5B58\u6C47\u603B - \u4F7F\u7528\u771F\u5B9E\u6570\u636E\r\n    const summary = await generateRealInventorySummary(env);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      data: summary,\r\n      message: '\u5E93\u5B58\u6C47\u603B\u83B7\u53D6\u6210\u529F'\r\n    }, { headers: corsHeaders });\r\n  }\r\n  \r\n  return Response.json({\r\n    success: false,\r\n    error: '\u4E0D\u652F\u6301\u7684\u5E93\u5B58API'\r\n  }, { status: 404, headers: corsHeaders });\r\n}\r\n\r\n// \u6570\u636E\u5206\u6790API\r\nasync function handleAnalyticsData(request, env, path, method, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u6570\u636E\u5206\u6790\u8BF7\u6C42:', path);\r\n  \r\n  if (path === '/api/analytics/sales' && method === 'GET') {\r\n    // \u9500\u552E\u5206\u6790 - \u4F7F\u7528\u771F\u5B9E\u6570\u636E\r\n    const salesAnalysis = await generateRealSalesAnalysis(env);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      data: salesAnalysis,\r\n      message: '\u9500\u552E\u5206\u6790\u5B8C\u6210'\r\n    }, { headers: corsHeaders });\r\n  } else if (path === '/api/analytics/trends' && method === 'GET') {\r\n    // \u8D8B\u52BF\u5206\u6790 - \u4F7F\u7528\u771F\u5B9E\u6570\u636E\r\n    const trendsAnalysis = await generateRealTrendsAnalysis(env);\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      data: trendsAnalysis,\r\n      message: '\u8D8B\u52BF\u5206\u6790\u5B8C\u6210'\r\n    }, { headers: corsHeaders });\r\n  }\r\n  \r\n  return Response.json({\r\n    success: false,\r\n    error: '\u4E0D\u652F\u6301\u7684\u5206\u6790API'\r\n  }, { status: 404, headers: corsHeaders });\r\n}\r\n\r\n// \u751F\u6210\u6A21\u62DF\u5E93\u5B58\u6570\u636E\r\nfunction generateMockInventoryData() {\r\n  const products = ['iPhone 15', 'Samsung Galaxy S24', 'iPad Pro', 'MacBook Air', 'AirPods Pro'];\r\n  const categories = ['\u624B\u673A', '\u5E73\u677F', '\u7B14\u8BB0\u672C', '\u914D\u4EF6'];\r\n  const suppliers = ['\u4F9B\u5E94\u5546A', '\u4F9B\u5E94\u5546B', '\u4F9B\u5E94\u5546C'];\r\n  \r\n  const data = [];\r\n  for (let i = 1; i <= 100; i++) {\r\n    data.push({\r\n      id: i,\r\n      sku: `SKU${String(i).padStart(6, '0')}`,\r\n      productName: products[Math.floor(Math.random() * products.length)],\r\n      category: categories[Math.floor(Math.random() * categories.length)],\r\n      supplier: suppliers[Math.floor(Math.random() * suppliers.length)],\r\n      stock: Math.floor(Math.random() * 1000) + 10,\r\n      price: (Math.random() * 5000 + 500).toFixed(2),\r\n      cost: (Math.random() * 3000 + 300).toFixed(2),\r\n      lastUpdate: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),\r\n      status: Math.random() > 0.1 ? '\u6B63\u5E38' : '\u7F3A\u8D27'\r\n    });\r\n  }\r\n  return data;\r\n}\r\n\r\n// \u8BA1\u7B97\u5E93\u5B58\u6C47\u603B\r\nfunction calculateInventorySummary(data) {\r\n  const totalProducts = data.length;\r\n  const totalStock = data.reduce((sum, item) => sum + item.stock, 0);\r\n  const totalValue = data.reduce((sum, item) => sum + (item.stock * parseFloat(item.price)), 0);\r\n  const lowStockItems = data.filter(item => item.stock < 50).length;\r\n  const outOfStockItems = data.filter(item => item.status === '\u7F3A\u8D27').length;\r\n  \r\n  return {\r\n    totalProducts,\r\n    totalStock,\r\n    totalValue: totalValue.toFixed(2),\r\n    lowStockItems,\r\n    outOfStockItems,\r\n    categories: [...new Set(data.map(item => item.category))].length\r\n  };\r\n}\r\n\r\n// \u751F\u6210\u9500\u552E\u5206\u6790\u6570\u636E\r\nfunction generateSalesAnalysis() {\r\n  const months = ['1\u6708', '2\u6708', '3\u6708', '4\u6708', '5\u6708', '6\u6708'];\r\n  const salesData = months.map(month => ({\r\n    month,\r\n    sales: Math.floor(Math.random() * 1000000) + 500000,\r\n    orders: Math.floor(Math.random() * 5000) + 1000,\r\n    avgOrderValue: (Math.random() * 500 + 200).toFixed(2)\r\n  }));\r\n  \r\n  return {\r\n    monthlySales: salesData,\r\n    totalSales: salesData.reduce((sum, item) => sum + item.sales, 0),\r\n    totalOrders: salesData.reduce((sum, item) => sum + item.orders, 0),\r\n    growthRate: ((Math.random() * 40 - 10).toFixed(1)) + '%'\r\n  };\r\n}\r\n\r\n// \u751F\u6210\u8D8B\u52BF\u5206\u6790\u6570\u636E\r\nfunction generateTrendsAnalysis() {\r\n  const categories = ['\u624B\u673A', '\u5E73\u677F', '\u7B14\u8BB0\u672C', '\u914D\u4EF6'];\r\n  const trends = categories.map(category => ({\r\n    category,\r\n    trend: Math.random() > 0.5 ? '\u4E0A\u5347' : '\u4E0B\u964D',\r\n    percentage: (Math.random() * 30).toFixed(1),\r\n    recommendation: Math.random() > 0.5 ? '\u589E\u52A0\u5E93\u5B58' : '\u51CF\u5C11\u8BA2\u8D2D'\r\n  }));\r\n  \r\n  return {\r\n    categoryTrends: trends,\r\n    hotProducts: ['iPhone 15', 'MacBook Air', 'AirPods Pro'],\r\n    seasonalForecast: '\u9884\u8BA1\u4E0B\u5B63\u5EA6\u9500\u91CF\u589E\u957F15%'\r\n  };\r\n}\r\n\r\n// \u7B80\u5355\u7684Excel\u6570\u636E\u89E3\u6790\uFF08\u6A21\u62DF\u89E3\u6790Excel\u5185\u5BB9\uFF09\r\nfunction parseExcelData(arrayBuffer) {\r\n  // \u5728\u5B9E\u9645\u73AF\u5883\u4E2D\uFF0C\u8FD9\u91CC\u5E94\u8BE5\u4F7F\u7528XLSX.js\u7B49\u5E93\u6765\u89E3\u6790Excel\r\n  // \u73B0\u5728\u6211\u4EEC\u751F\u6210\u6A21\u62DF\u7684SKU\u5E93\u5B58\u6570\u636E\uFF0C\u6309\u7167\u60A8\u9875\u9762\u4E2D\u663E\u793A\u7684\u683C\u5F0F\r\n  const mockData = [];\r\n  \r\n  for (let i = 1; i <= 100; i++) {\r\n    mockData.push({\r\n      SKU: `SKU${String(i).padStart(6, '0')}`,\r\n      \u5546\u54C1\u540D\u79F0: `\u5546\u54C1${i}`,\r\n      \u6700\u65B0\u5E93\u5B58: Math.floor(Math.random() * 1000) + 10,\r\n      \u52A8\u6001\u5E93\u5B58: Math.floor(Math.random() * 1000) + 10,\r\n      \u9500\u552E\u6570\u91CF: Math.floor(Math.random() * 50),\r\n      \u5355\u4EF7: (Math.random() * 1000 + 100).toFixed(2),\r\n      \u6210\u672C: (Math.random() * 500 + 50).toFixed(2),\r\n      \u5206\u7C7B: ['\u624B\u673A', '\u5E73\u677F', '\u7B14\u8BB0\u672C', '\u914D\u4EF6'][Math.floor(Math.random() * 4)],\r\n      \u4F9B\u5E94\u5546: ['\u4F9B\u5E94\u5546A', '\u4F9B\u5E94\u5546B', '\u4F9B\u5E94\u5546C'][Math.floor(Math.random() * 3)],\r\n      \u72B6\u6001: Math.random() > 0.1 ? '\u6B63\u5E38' : '\u7F3A\u8D27',\r\n      \u6700\u540E\u66F4\u65B0: new Date().toISOString()\r\n    });\r\n  }\r\n  \r\n  return mockData;\r\n}\r\n\r\n// \u83B7\u53D6\u6587\u4EF6\u6269\u5C55\u540D\r\nfunction getFileExtension(fileName) {\r\n  const lastDot = fileName.lastIndexOf('.');\r\n  return lastDot !== -1 ? fileName.substring(lastDot + 1) : 'xlsx';\r\n}\r\n\r\n// \u5904\u7406\u672C\u5730\u6570\u636E\u5E93API\u8BF7\u6C42\r\nasync function handleLocalDB(request, env, path, method, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u672C\u5730\u6570\u636E\u5E93\u8BF7\u6C42:', path);\r\n  \r\n  try {\r\n    // \u5BBD\u8868\u76F8\u5173API\r\n    if (path === '/api/localdb/wide' && method === 'GET') {\r\n      // \u8FD4\u56DE\u5BBD\u8868\u6570\u636E\uFF1A\u4F18\u5148\u5185\u5B58\uFF1B\u82E5\u4E3A\u7A7A\u5219\u5C1D\u8BD5\u4ECER2\u8BFB\u53D6\u5E76\u7F13\u5B58\r\n      let data = Array.isArray(wideTableCache) ? wideTableCache : [];\r\n      if ((!data || data.length === 0) && env.R2_BUCKET) {\r\n        try {\r\n          const obj = await env.R2_BUCKET.get(WIDE_TABLE_R2_KEY);\r\n          if (obj) {\r\n            const text = await obj.text();\r\n            const parsed = JSON.parse(text);\r\n            if (Array.isArray(parsed)) {\r\n              wideTableCache = parsed;\r\n              data = parsed;\r\n            }\r\n          }\r\n        } catch (e) { console.warn('\u8BFB\u53D6R2\u5BBD\u8868\u5931\u8D25:', e); }\r\n      }\r\n      await archiveOldDatesToRecords(env, 5);\r\n      data = wideTableCache;\r\n      // \u8BFB\u53D6\u540E\u8BA1\u7B97\u9500\u91CF\u5217\uFF08\u4E0D\u5F52\u6863\uFF0C\u907F\u514D\u7834\u574F\u524D\u7AEF\u5217\u7ED3\u6784\uFF09\r\n      wideTableCache = computeSalesForWideTableRows(wideTableCache);\r\n      data = wideTableCache;\r\n      return Response.json({ success: true, data, total: data.length }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/wide' && method === 'POST') {\r\n      // \u4FDD\u5B58\u5BBD\u8868\u6570\u636E\r\n      const requestData = await request.json();\r\n      console.log('\uD83D\uDCBE \u4FDD\u5B58\u5BBD\u8868\u6570\u636E:', requestData);\r\n      if (requestData && Array.isArray(requestData.data)) {\r\n        wideTableCache = requestData.data;\r\n        \r\n        // \u8BA1\u7B97\u9500\u91CF\r\n        wideTableCache = computeSalesForWideTableRows(wideTableCache);\r\n        \r\n        // \u6267\u884C\u81EA\u52A8\u5F52\u6863\uFF1A\u5C06\u8D85\u8FC75\u5929\u7684\u6570\u636E\u79FB\u52A8\u5230\u5386\u53F2\u8BB0\u5F55\r\n        await archiveOldDatesToRecords(env, 5);\r\n        \r\n        // \u5982\u679C\u5386\u53F2\u8BB0\u5F55\u4E3A\u7A7A\u4E14\u662F\u65B0\u5BFC\u5165\u7684\u6570\u636E\uFF0C\u751F\u6210\u4E00\u4E9B\u6D4B\u8BD5\u5386\u53F2\u8BB0\u5F55\r\n        if ((!Array.isArray(recordsCache) || recordsCache.length === 0) && wideTableCache.length > 0) {\r\n          recordsCache = generateTestHistoricalRecords(wideTableCache.slice(0, 5)); // \u4E3A\u524D5\u4E2ASKU\u751F\u6210\u5386\u53F2\u6570\u636E\r\n          console.log('\uD83D\uDD04 \u4E3A\u65B0\u5BFC\u5165\u6570\u636E\u751F\u6210\u4E86', recordsCache.length, '\u6761\u6D4B\u8BD5\u5386\u53F2\u8BB0\u5F55');\r\n        }\r\n        \r\n        // \u6301\u4E45\u5316\u5230R2\r\n        if (env.R2_BUCKET) {\r\n          try {\r\n            await env.R2_BUCKET.put(WIDE_TABLE_R2_KEY, JSON.stringify(wideTableCache), {\r\n              httpMetadata: { contentType: 'application/json' },\r\n              customMetadata: { updatedAt: new Date().toISOString() }\r\n            });\r\n            \r\n            // \u540C\u65F6\u4FDD\u5B58\u5386\u53F2\u8BB0\u5F55\u5230R2\r\n            if (Array.isArray(recordsCache) && recordsCache.length > 0) {\r\n              await env.R2_BUCKET.put(RECORDS_R2_KEY, JSON.stringify(recordsCache), {\r\n                httpMetadata: { contentType: 'application/json' },\r\n                customMetadata: { updatedAt: new Date().toISOString() }\r\n              });\r\n            }\r\n            \r\n            console.log('\u2705 \u6570\u636E\u5DF2\u6301\u4E45\u5316\u5230R2\uFF0C\u5BBD\u8868:', wideTableCache.length, '\u884C\uFF0C\u5386\u53F2\u8BB0\u5F55:', recordsCache.length, '\u6761');\r\n          } catch (e) { \r\n            console.warn('\u5199\u5165R2\u5931\u8D25:', e); \r\n          }\r\n        }\r\n      }\r\n      return Response.json({\r\n        success: true,\r\n        message: '\u5BBD\u8868\u6570\u636E\u4FDD\u5B58\u6210\u529F',\r\n        wideTableCount: wideTableCache.length,\r\n        recordsCount: recordsCache.length\r\n      }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/wide/export' && method === 'GET') {\r\n      // \u5BFC\u51FA\u5BBD\u8868\u6570\u636E\uFF1A\u4EC5\u5BFC\u51FA\u771F\u5B9E\u6570\u636E\uFF0C\u5FC5\u8981\u65F6\u4ECER2\u56DE\u586B\r\n      let data = Array.isArray(wideTableCache) ? wideTableCache : [];\r\n      if ((!data || data.length === 0) && env.R2_BUCKET) {\r\n        try {\r\n          const obj = await env.R2_BUCKET.get(WIDE_TABLE_R2_KEY);\r\n          if (obj) {\r\n            const text = await obj.text();\r\n            const parsed = JSON.parse(text);\r\n            if (Array.isArray(parsed)) {\r\n              wideTableCache = parsed;\r\n              data = parsed;\r\n            }\r\n          }\r\n        } catch (e) { console.warn('\u8BFB\u53D6R2\u5BBD\u8868\u5931\u8D25:', e); }\r\n      }\r\n      return Response.json({ success: true, data, message: '\u5BBD\u8868\u6570\u636E\u5BFC\u51FA\u6210\u529F' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/wide/batch' && method === 'POST') {\r\n      // \u6279\u91CF\u4E0A\u4F20\u5904\u7406 - \u652F\u6301\u6587\u4EF6\u4E0A\u4F20\u548CJSON\u6570\u636E\r\n      try {\r\n        const contentType = request.headers.get('content-type') || '';\r\n        \r\n        if (contentType.includes('multipart/form-data')) {\r\n          // \u5904\u7406\u6587\u4EF6\u76F4\u4F20\uFF1A\u5F53\u524D\u4E0D\u5728\u670D\u52A1\u7AEF\u89E3\u6790Excel\uFF0C\u63D0\u793A\u524D\u7AEF\u6539\u4E3AJSON\u4E0A\u4F20\r\n          const formData = await request.formData();\r\n          const file = formData.get('file');\r\n          if (!file) {\r\n            return Response.json({ success: false, error: '\u6CA1\u6709\u4E0A\u4F20\u6587\u4EF6' }, { headers: corsHeaders });\r\n          }\r\n          console.log('\uD83D\uDCE4 \u6536\u5230Excel\u6587\u4EF6\u76F4\u4F20(\u4E0D\u89E3\u6790):', file.name);\r\n          return Response.json({ success: true, message: `\u6587\u4EF6 ${file.name} \u5DF2\u63A5\u6536\uFF1B\u8BF7\u5728\u524D\u7AEF\u89E3\u6790\u540E\u4EE5JSON\u63D0\u4EA4`, processed: 0, data: [] }, { headers: corsHeaders });\r\n          \r\n        } else {\r\n          // \u5904\u7406JSON\u6570\u636E\r\n          const requestData = await request.json();\r\n          console.log('\uD83D\uDCE4 \u6279\u91CFJSON\u6570\u636E:', requestData);\r\n          if (requestData && Array.isArray(requestData.data)) {\r\n            wideTableCache = requestData.data;\r\n            // \u8BA1\u7B97\u9500\u91CF\u5E76\u6301\u4E45\u5316\u5230R2\r\n            wideTableCache = computeSalesForWideTableRows(wideTableCache);\r\n            if (env.R2_BUCKET) {\r\n              try {\r\n                await env.R2_BUCKET.put(WIDE_TABLE_R2_KEY, JSON.stringify(wideTableCache), {\r\n                  httpMetadata: { contentType: 'application/json' },\r\n                  customMetadata: { updatedAt: new Date().toISOString() }\r\n                });\r\n              } catch (e) { console.warn('\u5199\u5165R2\u5BBD\u8868\u5931\u8D25:', e); }\r\n            }\r\n            // \u4E0D\u81EA\u52A8\u5F52\u6863\uFF0C\u4FDD\u6301\u5217\u7ED3\u6784\u4E0D\u53D8\r\n          }\r\n          \r\n          return Response.json({ success: true, message: '\u6279\u91CF\u6570\u636E\u4E0A\u4F20\u6210\u529F', processed: requestData.data ? requestData.data.length : 0, data: Array.isArray(wideTableCache) ? wideTableCache : [] }, { headers: corsHeaders });\r\n        }\r\n        \r\n      } catch (parseError) {\r\n        console.error('\u6279\u91CF\u4E0A\u4F20\u89E3\u6790\u9519\u8BEF:', parseError);\r\n        return Response.json({\r\n          success: false,\r\n          error: `\u6570\u636E\u89E3\u6790\u5931\u8D25: ${parseError.message}`\r\n        }, { \r\n          status: 400,\r\n          headers: corsHeaders \r\n        });\r\n      }\r\n    }\r\n    \r\n    else if (path === '/api/localdb/wide/clear-all' && (method === 'POST' || method === 'GET')) {\r\n      // \u6E05\u7A7A\u7F13\u5B58\u5E76\u8FD4\u56DE\u6210\u529F\uFF1B\u652F\u6301 POST/GET \u65B9\u4FBF\u6D4F\u89C8\u5668\u76F4\u63A5\u9A8C\u8BC1\r\n      wideTableCache = [];\r\n      if (env.R2_BUCKET) {\r\n        try { await env.R2_BUCKET.delete(WIDE_TABLE_R2_KEY); } catch (e) { console.warn('\u5220\u9664R2\u5BBD\u8868\u5931\u8D25:', e); }\r\n      }\r\n      return Response.json({ success: true, message: '\u6210\u529F\u6E05\u7A7A\u6240\u6709\u5BBD\u8868\u6570\u636E' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    // \u8BB0\u5F55\u76F8\u5173API\r\n    else if (path === '/api/localdb/records' && method === 'GET') {\r\n      // \u8FD4\u56DE\u8BB0\u5F55\u5217\u8868\uFF1A\u5185\u5B58\u4F18\u5148\uFF0C\u5176\u6B21R2\r\n      let data = Array.isArray(recordsCache) ? recordsCache : [];\r\n      if ((!data || data.length === 0) && env.R2_BUCKET) {\r\n        try { const obj = await env.R2_BUCKET.get(RECORDS_R2_KEY); if (obj) { const text = await obj.text(); const parsed = JSON.parse(text); if (Array.isArray(parsed)) { recordsCache = parsed; data = parsed; } } } catch(e){ console.warn('\u8BFB\u53D6R2\u8BB0\u5F55\u5931\u8D25:', e); }\r\n      }\r\n      return Response.json({ success: true, data, total: data.length }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/records' && method === 'POST') {\r\n      // \u6DFB\u52A0\u8BB0\u5F55\uFF08JSON\uFF09\r\n      const requestData = await request.json();\r\n      console.log('\u2795 \u6DFB\u52A0\u8BB0\u5F55:', requestData);\r\n      const record = { ...requestData, id: Date.now() };\r\n      if (!Array.isArray(recordsCache)) recordsCache = [];\r\n      recordsCache.unshift(record);\r\n      if (env.R2_BUCKET) { try { await env.R2_BUCKET.put(RECORDS_R2_KEY, JSON.stringify(recordsCache), { httpMetadata: { contentType: 'application/json' } }); } catch(e){ console.warn('\u5199\u5165R2\u8BB0\u5F55\u5931\u8D25:', e);} }\r\n      return Response.json({ success: true, message: '\u8BB0\u5F55\u6DFB\u52A0\u6210\u529F', data: record }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path.startsWith('/api/localdb/records/') && method === 'PUT') {\r\n      // \u66F4\u65B0\u8BB0\u5F55\r\n      const recordId = path.split('/').pop();\r\n      const requestData = await request.json();\r\n      console.log('\u270F\uFE0F \u66F4\u65B0\u8BB0\u5F55:', recordId, requestData);\r\n      if (Array.isArray(recordsCache)) {\r\n        const idx = recordsCache.findIndex(r => String(r.id) === String(recordId));\r\n        if (idx !== -1) { recordsCache[idx] = { ...recordsCache[idx], ...requestData, id: recordsCache[idx].id }; }\r\n      }\r\n      if (env.R2_BUCKET) { try { await env.R2_BUCKET.put(RECORDS_R2_KEY, JSON.stringify(recordsCache), { httpMetadata: { contentType: 'application/json' } }); } catch(e){ console.warn('\u5199\u5165R2\u8BB0\u5F55\u5931\u8D25:', e);} }\r\n      return Response.json({ success: true, message: '\u8BB0\u5F55\u66F4\u65B0\u6210\u529F', data: { ...requestData, id: recordId } }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path.startsWith('/api/localdb/records/') && method === 'DELETE') {\r\n      // \u5220\u9664\u8BB0\u5F55\r\n      const recordId = path.split('/').pop();\r\n      console.log('\uD83D\uDDD1\uFE0F \u5220\u9664\u8BB0\u5F55:', recordId);\r\n      if (Array.isArray(recordsCache)) recordsCache = recordsCache.filter(r => String(r.id) !== String(recordId));\r\n      if (env.R2_BUCKET) { try { await env.R2_BUCKET.put(RECORDS_R2_KEY, JSON.stringify(recordsCache), { httpMetadata: { contentType: 'application/json' } }); } catch(e){ console.warn('\u5199\u5165R2\u8BB0\u5F55\u5931\u8D25:', e);} }\r\n      return Response.json({ success: true, message: '\u8BB0\u5F55\u5220\u9664\u6210\u529F' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/records/batch' && method === 'POST') {\r\n      // \u6279\u91CF\u5BFC\u5165\u8BB0\u5F55\uFF08JSON\u4F18\u5148\uFF1Bmultipart\u4EC5\u63D0\u793A\uFF09\r\n      const contentType = request.headers.get('content-type') || '';\r\n      if (contentType.includes('multipart/form-data')) {\r\n        return Response.json({ success: true, message: '\u6587\u4EF6\u5DF2\u63A5\u6536\uFF1B\u8BF7\u524D\u7AEF\u89E3\u6790\u6210JSON\u540E\u63D0\u4EA4' }, { headers: corsHeaders });\r\n      }\r\n      const requestData = await request.json();\r\n      console.log('\uD83D\uDCE4 \u6279\u91CF\u5BFC\u5165\u8BB0\u5F55(JSON):', requestData);\r\n      if (requestData && Array.isArray(requestData.data)) {\r\n        if (!Array.isArray(recordsCache)) recordsCache = [];\r\n        // \u751F\u6210id\u5E76\u63D2\u5165\u5230\u5934\u90E8\r\n        const now = Date.now();\r\n        const withIds = requestData.data.map((r, i) => ({ id: now + i, ...r }));\r\n        recordsCache = [...withIds, ...recordsCache];\r\n        if (env.R2_BUCKET) { try { await env.R2_BUCKET.put(RECORDS_R2_KEY, JSON.stringify(recordsCache), { httpMetadata: { contentType: 'application/json' } }); } catch(e){ console.warn('\u5199\u5165R2\u8BB0\u5F55\u5931\u8D25:', e);} }\r\n        return Response.json({ success: true, message: '\u6279\u91CF\u8BB0\u5F55\u5BFC\u5165\u6210\u529F', processed: withIds.length }, { headers: corsHeaders });\r\n      }\r\n      return Response.json({ success: false, error: '\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/records/export' && method === 'GET') {\r\n      // \u5BFC\u51FA\u8BB0\u5F55\u6570\u636E\uFF08\u771F\u5B9E\uFF09\r\n      let data = Array.isArray(recordsCache) ? recordsCache : [];\r\n      if ((!data || data.length === 0) && env.R2_BUCKET) {\r\n        try { const obj = await env.R2_BUCKET.get(RECORDS_R2_KEY); if (obj) { const text = await obj.text(); const parsed = JSON.parse(text); if (Array.isArray(parsed)) { recordsCache = parsed; data = parsed; } } } catch(e){ console.warn('\u8BFB\u53D6R2\u8BB0\u5F55\u5931\u8D25:', e); }\r\n      }\r\n      return Response.json({ success: true, data, message: '\u8BB0\u5F55\u6570\u636E\u5BFC\u51FA\u6210\u529F' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else if (path === '/api/localdb/records/clear-all' && (method === 'POST' || method === 'GET')) {\r\n      recordsCache = [];\r\n      if (env.R2_BUCKET) { try { await env.R2_BUCKET.delete(RECORDS_R2_KEY); } catch(e){ console.warn('\u5220\u9664R2\u8BB0\u5F55\u5931\u8D25:', e);} }\r\n      return Response.json({ success: true, message: '\u6210\u529F\u6E05\u7A7A\u6240\u6709\u8BB0\u5F55\u6570\u636E' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    else {\r\n      return new Response('Not Found', { status: 404, headers: corsHeaders });\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('\u274C LocalDB API\u9519\u8BEF:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { \r\n      status: 500,\r\n      headers: corsHeaders \r\n    });\r\n  }\r\n}\r\n\r\n// \u751F\u6210\u6A21\u62DF\u5BBD\u8868\u6570\u636E\r\nfunction generateMockWideData() {\r\n  const data = [];\r\n  const now = Date.now();\r\n  const format = (d) => {\r\n    const pad = (n) => String(n).padStart(2, '0');\r\n    const dt = new Date(d);\r\n    return `${dt.getFullYear()}/${pad(dt.getMonth()+1)}/${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`;\r\n  };\r\n  for (let i = 1; i <= 50; i++) {\r\n    data.push({\r\n      '\u7CFB\u7EDF\u5C65\u7EA6\u5355\u53F7': `${Date.now()}${String(i).padStart(4,'0')}`,\r\n      '\u5E97\u94FA\u8BA2\u5355\u65F6\u95F4': format(now - i * 1234567),\r\n      'SKU': `X${String(774305 + i).padStart(6,'0')}NA`,\r\n      '\u5546\u54C1\u6570\u91CF': 1\r\n    });\r\n  }\r\n  return data;\r\n}\r\n\r\n// \u751F\u6210\u6A21\u62DF\u8BB0\u5F55\u6570\u636E\r\nfunction generateMockRecords() {\r\n    const records = [];\r\n    const TEN_DAYS_MS = 10 * 24 * 60 * 60 * 1000;\r\n    const statuses = ['\u5DF2\u5904\u7406', '\u5904\u7406\u4E2D', '\u5931\u8D25'];\r\n\r\n    for (let i = 1; i <= 20; i++) {\r\n        records.push({\r\n            id: i,\r\n            fileName: `Excel\u6570\u636E\u8868${i}.xlsx`,\r\n            uploadTime: new Date(Date.now() - Math.random() * TEN_DAYS_MS).toISOString(),\r\n            recordCount: Math.floor(Math.random() * 500) + 100,\r\n            status: statuses[Math.floor(Math.random() * statuses.length)],\r\n            description: `\u6279\u6B21${i}\u7684\u5E93\u5B58\u6570\u636E\u5BFC\u5165`\r\n        });\r\n    }\r\n\r\n    return records.sort((a, b) => Date.parse(b.uploadTime) - Date.parse(a.uploadTime));\r\n}\r\n\r\n// \u4ECE\u6587\u4EF6\u540D\u4E2D\u63D0\u53D6ID\r\nfunction extractIdFromFileName(filePath) {\r\n  const fileName = filePath.split('/').pop();\r\n  const match = fileName.match(/^(\\d+)-/);\r\n  return match ? match[1] : fileName;\r\n}\r\n\r\n// \u4E0B\u8F7D\u6253\u5305\u6587\u4EF6\r\nasync function handlePackageFileDownload(request, env, path, corsHeaders) {\r\n  try {\r\n    const id = path.split('/')[3];\r\n    if (!env.R2_BUCKET) throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    \r\n    // \u5728 package/ \u524D\u7F00\u4E0B\u67E5\u627E\u5305\u542B\u8BE5ID\u7684\u6587\u4EF6\r\n    const list = await env.R2_BUCKET.list({ prefix: 'package/' });\r\n    const match = list.objects.find(o => o.key.includes(id));\r\n    \r\n    if (!match) {\r\n      return Response.json({ success: false, error: '\u6587\u4EF6\u4E0D\u5B58\u5728' }, { status: 404, headers: corsHeaders });\r\n    }\r\n    \r\n    const obj = await env.R2_BUCKET.get(match.key);\r\n    if (!obj) {\r\n      return Response.json({ success: false, error: '\u6587\u4EF6\u4E0D\u5B58\u5728' }, { status: 404, headers: corsHeaders });\r\n    }\r\n    \r\n    const headers = new Headers(corsHeaders);\r\n    headers.set('Content-Type', obj.httpMetadata?.contentType || 'application/octet-stream');\r\n    headers.set('Content-Disposition', `attachment; filename=\"${(obj.customMetadata?.originalName)||'download'}\"`);\r\n    return new Response(obj.body, { headers });\r\n  } catch (error) {\r\n    console.error('\u4E0B\u8F7D\u6253\u5305\u6587\u4EF6\u5931\u8D25:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u4E0B\u8F7D\u6587\u4EF6\uFF1A\u5C06 R2 \u5BF9\u8C61\u6D41\u5F0F\u8FD4\u56DE\r\nasync function handleFileDownload(request, env, path, corsHeaders) {\r\n  try {\r\n    const id = path.split('/')[3];\r\n    // \u7531\u4E8E\u5F53\u524D\u6587\u4EF6\u5217\u8868\u6CA1\u6709\u4FDD\u5B58 id->key \u7684\u6620\u5C04\uFF0C\u4F7F\u7528\u7EA6\u5B9A\uFF1Aid \u4E3A\u65F6\u95F4\u6233\u524D\u7F00\uFF0C\u5339\u914D arc/ \u524D\u7F00\u4E0B\u5305\u542B\u8BE5\u524D\u7F00\u7684\u5BF9\u8C61\r\n    if (!env.R2_BUCKET) throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    const list = await env.R2_BUCKET.list({ prefix: 'arc/' });\r\n    const match = list.objects.find(o => o.key.includes(id));\r\n    if (!match) {\r\n      return Response.json({ success: false, error: '\u6587\u4EF6\u4E0D\u5B58\u5728' }, { status: 404, headers: corsHeaders });\r\n    }\r\n    const obj = await env.R2_BUCKET.get(match.key);\r\n    if (!obj) {\r\n      return Response.json({ success: false, error: '\u6587\u4EF6\u4E0D\u5B58\u5728' }, { status: 404, headers: corsHeaders });\r\n    }\r\n    const headers = new Headers(corsHeaders);\r\n    headers.set('Content-Type', obj.httpMetadata?.contentType || 'application/octet-stream');\r\n    headers.set('Content-Disposition', `attachment; filename=\"${(obj.customMetadata?.originalName)||'download.xlsx'}\"`);\r\n    return new Response(obj.body, { headers });\r\n  } catch (error) {\r\n    console.error('\u4E0B\u8F7D\u5931\u8D25:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u89E3\u6790/\u9884\u89C8\u6587\u4EF6\uFF1A\u8FD4\u56DE\u6A21\u62DF\u7684\u5206\u9875\u4E0E\u8868\u5934\u6570\u636E\uFF08\u5360\u4F4D\u5B9E\u73B0\uFF09\r\nasync function handleFileAnalyze(request, env, path, corsHeaders) {\r\n  try {\r\n    const url = new URL(request.url);\r\n    const id = path.split('/')[3];\r\n    const sheet = url.searchParams.get('sheet') || 'Sheet1';\r\n    const page = parseInt(url.searchParams.get('page')||'1');\r\n    const limit = parseInt(url.searchParams.get('limit')||'20');\r\n\r\n    // \u751F\u6210\u6A21\u62DF\u6570\u636E\uFF08\u540E\u7EED\u53EF\u6539\u4E3A\u4ECE R2 \u8BFB\u53D6\u5E76\u7528 XLSX \u89E3\u6790\uFF09\r\n    const headers = ['SKU','\u5217A','\u5217B','\u5217C','\u5217D','\u5217E'];\r\n    const rowsTotal = 150;\r\n    const allRows = Array.from({length: rowsTotal}, (_,i)=>[\r\n      `SKU${String(i+1).padStart(6,'0')}`,'A'+(i+1),'B'+(i+1),'C'+(i+1),'D'+(i+1),'E'+(i+1)\r\n    ]);\r\n    const start = (page-1)*limit;\r\n    const data = allRows.slice(start, start+limit);\r\n\r\n    // \u7B80\u5355\u6A21\u62DF\u6240\u6709\u5DE5\u4F5C\u8868\u4FE1\u606F\r\n    const allSheets = [\r\n      { name:'Sheet1', rowCount: rowsTotal, colCount: headers.length, headers: headers.slice(0,6) },\r\n      { name:'Sheet2', rowCount: 0, colCount: 0, headers: [] }\r\n    ];\r\n\r\n    return Response.json({\r\n      success: true,\r\n      analysis: {\r\n        fileName: `\u6587\u4EF6_${id}.xlsx`,\r\n        currentSheet: sheet,\r\n        allSheets,\r\n        headers,\r\n        data,\r\n        pagination: {\r\n          currentPage: page,\r\n          totalPages: Math.ceil(rowsTotal/limit),\r\n          totalRows: rowsTotal,\r\n          limit,\r\n          hasNext: page*limit<rowsTotal,\r\n          hasPrev: page>1\r\n        },\r\n        summary: {\r\n          uploadTime: new Date().toISOString(),\r\n          fileSize: 1024*1024,\r\n          uploadedBy: 'admin',\r\n          totalSheets: allSheets.length\r\n        },\r\n        performance: { processingTime: 5 }\r\n      }\r\n    }, { headers: corsHeaders });\r\n  } catch (error) {\r\n    console.error('\u5206\u6790\u5931\u8D25:', error);\r\n    return Response.json({ success:false, error: error.message }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u5904\u7406\u6253\u5305\u7CFB\u7EDF\u7684R2\u8DEF\u7531\uFF08/api/r2/*\uFF09\r\nasync function handleR2Routes(request, env, path, method, corsHeaders) {\r\n  try {\r\n    // \u4E0A\u4F20\uFF1A/api/r2/upload/package/<path>\r\n    if (path.startsWith('/api/r2/upload/package/') && method === 'POST') {\r\n      const targetPath = decodeURIComponent(path.replace('/api/r2/upload/package/', ''));\r\n      const formData = await request.formData();\r\n      const file = formData.get('file');\r\n      if (!file) {\r\n        return Response.json({ success: false, error: '\u6CA1\u6709\u4E0A\u4F20\u6587\u4EF6' }, { headers: corsHeaders });\r\n      }\r\n      const r2Key = `package/${targetPath}`;\r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      await env.R2_BUCKET.put(r2Key, file.stream(), {\r\n        httpMetadata: { contentType: file.type || 'application/octet-stream' },\r\n        customMetadata: {\r\n          originalName: file.name,\r\n          uploadTime: new Date().toISOString()\r\n        }\r\n      });\r\n      return Response.json({ success: true, message: '\u4E0A\u4F20\u6210\u529F', filePath: r2Key, size: file.size || 0 }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u5217\u8868\uFF1A/api/r2/list-files?folder=package&prefix=...&limit=...\r\n    if (path === '/api/r2/list-files' && method === 'GET') {\r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      const url = new URL(request.url);\r\n      const folder = url.searchParams.get('folder') || '';\r\n      const prefix = url.searchParams.get('prefix') || '';\r\n      const limit = parseInt(url.searchParams.get('limit') || '100');\r\n      const keyPrefix = folder ? `${folder}/${prefix || ''}` : prefix;\r\n      const res = await env.R2_BUCKET.list({ prefix: keyPrefix, limit });\r\n      return Response.json({ success: true, files: res.objects || [] }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u5220\u9664\uFF1A/api/r2/delete/<path>\r\n    if (path.startsWith('/api/r2/delete/') && method === 'DELETE') {\r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      const targetPath = decodeURIComponent(path.replace('/api/r2/delete/', ''));\r\n      await env.R2_BUCKET.delete(targetPath);\r\n      return Response.json({ success: true, message: '\u5220\u9664\u6210\u529F' }, { headers: corsHeaders });\r\n    }\r\n\r\n    // \u516C\u5171URL\uFF1A/api/r2/public-url/<filename>?folder=package\r\n    if (path.startsWith('/api/r2/public-url/') && method === 'GET') {\r\n      const url = new URL(request.url);\r\n      const folder = url.searchParams.get('folder') || '';\r\n      const fileName = decodeURIComponent(path.replace('/api/r2/public-url/', ''));\r\n      const key = folder ? `${folder}/${fileName}` : fileName;\r\n      const publicUrl = `https://23441d4f7734b84186c4c20ddefef8e7.r2.cloudflarestorage.com/century-business-system/${key}`;\r\n      return Response.json({ success: true, url: publicUrl }, { headers: corsHeaders });\r\n    }\r\n\r\n    return Response.json({ success: false, error: '\u4E0D\u652F\u6301\u7684R2\u8DEF\u7531' }, { status: 404, headers: corsHeaders });\r\n  } catch (error) {\r\n    console.error('R2\u8DEF\u7531\u9519\u8BEF:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u5904\u7406\u5929\u732B\u8BA2\u5355API\u8BF7\u6C42 - \u6620\u5C04\u5230localdb\u529F\u80FD\r\nasync function handleTmallOrders(request, env, path, method, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u5929\u732B\u8BA2\u5355\u8BF7\u6C42:', path);\r\n  \r\n  try {\r\n    // \u6062\u590D\uFF1A\u5C06 tmall-orders \u8DEF\u5F84\u7B80\u5355\u6620\u5C04\u5230 localdb\uFF08\u4E0E\u4E4B\u524D\u53EF\u6B63\u5E38\u663E\u793A\u5206\u6790\u56FE\u8868\u7684\u884C\u4E3A\u4E00\u81F4\uFF09\r\n    let mappedPath = path.replace('/api/tmall-orders/', '/api/localdb/');\r\n    \r\n    // \u7279\u6B8A\u8DEF\u5F84\u6620\u5C04\r\n    if (path.endsWith('/smart-import')) {\r\n      mappedPath = '/api/localdb/wide/batch';\r\n    } else if (path.endsWith('/wide/clear-all')) {\r\n      // \u660E\u786E\u5904\u7406 clear-all\uFF0C\u907F\u514D\u5C06 \"clear-all\" \u518D\u6B21\u66FF\u6362\u6210 \"clear-all-all\"\r\n      mappedPath = '/api/localdb/wide/clear-all';\r\n    } else if (path.endsWith('/wide/clear')) {\r\n      mappedPath = '/api/localdb/wide/clear-all';\r\n    }\r\n    \r\n    console.log(`\uD83D\uDCCD \u8DEF\u5F84\u6620\u5C04: ${path} \u2192 ${mappedPath}`);\r\n    \r\n    // \u8C03\u7528\u73B0\u6709\u7684localdb\u5904\u7406\u51FD\u6570\r\n    return await handleLocalDB(request, env, mappedPath, method, corsHeaders);\r\n    \r\n  } catch (error) {\r\n    console.error('\u274C \u5929\u732B\u8BA2\u5355API\u9519\u8BEF:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { \r\n      status: 500,\r\n      headers: corsHeaders \r\n    });\r\n  }\r\n}\r\n\r\n// \u5904\u7406\u6253\u5305\u7CFB\u7EDF\u6570\u636E\u540C\u6B65\uFF08/api/package-sync/*\uFF09\r\nasync function handlePackageSync(request, env, path, method, corsHeaders) {\r\n  try {\r\n    // \u4E0A\u4F20\u6570\u636E\u5E93\uFF1A/api/package-sync/database\r\n    if (path === '/api/package-sync/database' && method === 'POST') {\r\n      const data = await request.json();\r\n      const key = 'package-sync/database.json';\r\n      \r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      \r\n      // \u4FDD\u5B58\u5230R2\r\n      await env.R2_BUCKET.put(key, JSON.stringify({\r\n        ...data,\r\n        lastSync: new Date().toISOString()\r\n      }), {\r\n        httpMetadata: { contentType: 'application/json' }\r\n      });\r\n      \r\n      return Response.json({ success: true, message: '\u6570\u636E\u5E93\u540C\u6B65\u6210\u529F' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    // \u4E0B\u8F7D\u6570\u636E\u5E93\uFF1A/api/package-sync/database\r\n    if (path === '/api/package-sync/database' && method === 'GET') {\r\n      const key = 'package-sync/database.json';\r\n      \r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      \r\n      const object = await env.R2_BUCKET.get(key);\r\n      if (!object) {\r\n        return Response.json({ success: false, data: null, message: '\u6682\u65E0\u540C\u6B65\u6570\u636E' }, { headers: corsHeaders });\r\n      }\r\n      \r\n      const data = await object.json();\r\n      return Response.json({ success: true, data }, { headers: corsHeaders });\r\n    }\r\n    \r\n    // \u4E0A\u4F20\u6587\u4EF6\u6CE8\u518C\u8868\uFF1A/api/package-sync/files\r\n    if (path === '/api/package-sync/files' && method === 'POST') {\r\n      const data = await request.json();\r\n      const key = 'package-sync/files.json';\r\n      \r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      \r\n      // \u4FDD\u5B58\u5230R2\r\n      await env.R2_BUCKET.put(key, JSON.stringify({\r\n        ...data,\r\n        lastSync: new Date().toISOString()\r\n      }), {\r\n        httpMetadata: { contentType: 'application/json' }\r\n      });\r\n      \r\n      return Response.json({ success: true, message: '\u6587\u4EF6\u6CE8\u518C\u8868\u540C\u6B65\u6210\u529F' }, { headers: corsHeaders });\r\n    }\r\n    \r\n    // \u4E0B\u8F7D\u6587\u4EF6\u6CE8\u518C\u8868\uFF1A/api/package-sync/files\r\n    if (path === '/api/package-sync/files' && method === 'GET') {\r\n      const key = 'package-sync/files.json';\r\n      \r\n      if (!env.R2_BUCKET) {\r\n        return Response.json({ success: false, error: 'R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528' }, { headers: corsHeaders, status: 500 });\r\n      }\r\n      \r\n      const object = await env.R2_BUCKET.get(key);\r\n      if (!object) {\r\n        return Response.json({ success: false, data: null, message: '\u6682\u65E0\u540C\u6B65\u6570\u636E' }, { headers: corsHeaders });\r\n      }\r\n      \r\n      const data = await object.json();\r\n      return Response.json({ success: true, data }, { headers: corsHeaders });\r\n    }\r\n    \r\n    return Response.json({ success: false, error: '\u4E0D\u652F\u6301\u7684\u540C\u6B65\u64CD\u4F5C' }, { status: 404, headers: corsHeaders });\r\n  } catch (error) {\r\n    console.error('\u6570\u636E\u540C\u6B65\u5931\u8D25:', error);\r\n    return Response.json({ success: false, error: error.message }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// ==================== \u771F\u5B9E\u6570\u636E\u5206\u6790\u51FD\u6570 ====================\r\n\r\n// \u4ECER2\u8BFB\u53D6\u771F\u5B9E\u6570\u636E\u5E76\u8FDB\u884C\u5206\u6790\r\nasync function getRealDataFromR2(env) {\r\n  let wideData = [];\r\n  let recordsData = [];\r\n  \r\n  // \u5C1D\u8BD5\u4ECER2\u8BFB\u53D6\u5BBD\u8868\u6570\u636E\r\n  if (env.R2_BUCKET) {\r\n    try {\r\n      const wideObj = await env.R2_BUCKET.get(WIDE_TABLE_R2_KEY);\r\n      if (wideObj) {\r\n        const wideText = await wideObj.text();\r\n        wideData = JSON.parse(wideText) || [];\r\n      }\r\n    } catch (e) {\r\n      console.warn('\u8BFB\u53D6R2\u5BBD\u8868\u6570\u636E\u5931\u8D25:', e);\r\n    }\r\n    \r\n    try {\r\n      const recordsObj = await env.R2_BUCKET.get(RECORDS_R2_KEY);\r\n      if (recordsObj) {\r\n        const recordsText = await recordsObj.text();\r\n        recordsData = JSON.parse(recordsText) || [];\r\n      }\r\n    } catch (e) {\r\n      console.warn('\u8BFB\u53D6R2\u5386\u53F2\u8BB0\u5F55\u5931\u8D25:', e);\r\n    }\r\n  }\r\n  \r\n  // \u5982\u679CR2\u6CA1\u6709\u6570\u636E\uFF0C\u4F7F\u7528\u5185\u5B58\u7F13\u5B58\r\n  if (wideData.length === 0 && Array.isArray(wideTableCache)) {\r\n    wideData = wideTableCache;\r\n  }\r\n  if (recordsData.length === 0 && Array.isArray(recordsCache)) {\r\n    recordsData = recordsCache;\r\n  }\r\n  \r\n  return { wideData, recordsData };\r\n}\r\n\r\n// \u751F\u6210\u771F\u5B9E\u9500\u552E\u5206\u6790\u6570\u636E\r\nasync function generateRealSalesAnalysis(env) {\r\n  const { wideData, recordsData } = await getRealDataFromR2(env);\r\n  \r\n  // \u8BA1\u7B97\u7EDF\u8BA1\u6570\u636E\r\n  const totalSku = new Set([...wideData.map(r => r.SKU), ...recordsData.map(r => r.SKU)]).size;\r\n  \r\n  // \u8BA1\u7B97\u5E93\u5B58\u5065\u5EB7\u7387 (\u6709\u5E93\u5B58\u7684SKU\u6BD4\u4F8B)\r\n  const healthySku = wideData.filter(row => {\r\n    const dates = Object.keys(row).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k));\r\n    return dates.some(date => (parseInt(row[date]) || 0) > 0);\r\n  }).length;\r\n  const healthRate = totalSku > 0 ? Math.round((healthySku / totalSku) * 100) : 0;\r\n  \r\n  // \u8BA1\u7B97\u603B\u9500\u91CF\r\n  let totalSales = 0;\r\n  wideData.forEach(row => {\r\n    Object.keys(row).forEach(key => {\r\n      if (key.includes('_\u9500\u91CF')) {\r\n        totalSales += parseInt(row[key]) || 0;\r\n      }\r\n    });\r\n  });\r\n  recordsData.forEach(record => {\r\n    totalSales += parseInt(record['\u9500\u91CF']) || 0;\r\n  });\r\n  \r\n  // \u5E73\u5747\u5468\u8F6C\u7387 (\u7B80\u5316\u8BA1\u7B97)\r\n  const avgTurnover = totalSku > 0 ? Math.round(totalSales / totalSku * 10) / 10 : 0;\r\n  \r\n  // \u5E93\u5B58\u9884\u8B66 (\u5E93\u5B58\u4E3A0\u7684SKU)\r\n  const warningCount = wideData.filter(row => {\r\n    const dates = Object.keys(row).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k));\r\n    return dates.every(date => (parseInt(row[date]) || 0) === 0);\r\n  }).length;\r\n  \r\n  return {\r\n    totalSku: totalSku,\r\n    healthRate: healthRate,\r\n    avgTurnover: avgTurnover,\r\n    warningCount: warningCount,\r\n    totalRecords: recordsData.length,\r\n    totalSales: totalSales\r\n  };\r\n}\r\n\r\n// \u751F\u6210\u771F\u5B9E\u8D8B\u52BF\u5206\u6790\u6570\u636E\r\nasync function generateRealTrendsAnalysis(env) {\r\n  const { wideData, recordsData } = await getRealDataFromR2(env);\r\n  \r\n  // \u6536\u96C6\u6240\u6709\u65E5\u671F\r\n  const allDates = new Set();\r\n  wideData.forEach(row => {\r\n    Object.keys(row).forEach(key => {\r\n      if (/^\\d{4}-\\d{2}-\\d{2}$/.test(key)) {\r\n        allDates.add(key);\r\n      }\r\n    });\r\n  });\r\n  recordsData.forEach(record => {\r\n    if (record['\u65E5\u671F']) {\r\n      const dateMatch = record['\u65E5\u671F'].match(/(\\d{4}-\\d{2}-\\d{2})/);\r\n      if (dateMatch) {\r\n        allDates.add(dateMatch[1]);\r\n      }\r\n    }\r\n  });\r\n  \r\n  const sortedDates = Array.from(allDates).sort();\r\n  \r\n  // \u8BA1\u7B97\u6BCF\u65E5\u5E93\u5B58\u548C\u9500\u91CF\u8D8B\u52BF\r\n  const trends = sortedDates.map(date => {\r\n    let totalStock = 0;\r\n    let totalSales = 0;\r\n    \r\n    // \u4ECE\u5BBD\u8868\u6570\u636E\u8BA1\u7B97\r\n    wideData.forEach(row => {\r\n      if (row[date] !== undefined) {\r\n        totalStock += parseInt(row[date]) || 0;\r\n      }\r\n      if (row[date + '_\u9500\u91CF'] !== undefined) {\r\n        totalSales += parseInt(row[date + '_\u9500\u91CF']) || 0;\r\n      }\r\n    });\r\n    \r\n    // \u4ECE\u8BB0\u5F55\u6570\u636E\u8BA1\u7B97\r\n    recordsData.forEach(record => {\r\n      if (record['\u65E5\u671F'] && record['\u65E5\u671F'].includes(date)) {\r\n        totalStock += parseInt(record['\u5E93\u5B58']) || 0;\r\n        totalSales += parseInt(record['\u9500\u91CF']) || 0;\r\n      }\r\n    });\r\n    \r\n    return {\r\n      date: date,\r\n      stock: totalStock,\r\n      sales: totalSales\r\n    };\r\n  });\r\n  \r\n  return trends;\r\n}\r\n\r\n// \u751F\u6210\u771F\u5B9E\u9500\u552E\u6570\u636E\r\nasync function generateRealSalesData(env) {\r\n  const { wideData, recordsData } = await getRealDataFromR2(env);\r\n  \r\n  // \u5408\u5E76\u6570\u636E\u4E3A\u9500\u552E\u8D8B\u52BF\u683C\u5F0F\r\n  const salesData = [];\r\n  \r\n  // \u5904\u7406\u5BBD\u8868\u6570\u636E\r\n  wideData.forEach(row => {\r\n    Object.keys(row).forEach(key => {\r\n      if (key.includes('_\u9500\u91CF')) {\r\n        const date = key.replace('_\u9500\u91CF', '');\r\n        const sales = parseInt(row[key]) || 0;\r\n        if (sales > 0) {\r\n          salesData.push({\r\n            date: date,\r\n            sku: row.SKU,\r\n            sales: sales,\r\n            productName: row['\u4EA7\u54C1\u4E2D\u6587\u540D']\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n  \r\n  // \u5904\u7406\u8BB0\u5F55\u6570\u636E\r\n  recordsData.forEach(record => {\r\n    const sales = parseInt(record['\u9500\u91CF']) || 0;\r\n    if (sales > 0 && record['\u65E5\u671F']) {\r\n      const dateMatch = record['\u65E5\u671F'].match(/(\\d{4}-\\d{2}-\\d{2})/);\r\n      if (dateMatch) {\r\n        salesData.push({\r\n          date: dateMatch[1],\r\n          sku: record.SKU,\r\n          sales: sales,\r\n          productName: record['\u4EA7\u54C1\u4E2D\u6587\u540D']\r\n        });\r\n      }\r\n    }\r\n  });\r\n  \r\n  return salesData;\r\n}\r\n\r\n// \u751F\u6210\u771F\u5B9E\u5E93\u5B58\u6C47\u603B\r\nasync function generateRealInventorySummary(env) {\r\n  const { wideData, recordsData } = await getRealDataFromR2(env);\r\n  \r\n  // \u6309SKU\u6C47\u603B\u6570\u636E\r\n  const skuSummary = {};\r\n  \r\n  // \u5904\u7406\u5BBD\u8868\u6570\u636E\r\n  wideData.forEach(row => {\r\n    if (!row.SKU) return;\r\n    \r\n    if (!skuSummary[row.SKU]) {\r\n      skuSummary[row.SKU] = {\r\n        sku: row.SKU,\r\n        productName: row['\u4EA7\u54C1\u4E2D\u6587\u540D'] || '',\r\n        url: row['\u7F51\u9875\u94FE\u63A5'] || '',\r\n        initialStock: parseInt(row['\u521D\u59CB\u5E93\u5B58']) || 0,\r\n        currentStock: 0,\r\n        totalSales: 0,\r\n        lastUpdate: ''\r\n      };\r\n    }\r\n    \r\n    // \u627E\u6700\u65B0\u5E93\u5B58\r\n    const dates = Object.keys(row).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k)).sort();\r\n    if (dates.length > 0) {\r\n      const latestDate = dates[dates.length - 1];\r\n      skuSummary[row.SKU].currentStock = parseInt(row[latestDate]) || 0;\r\n      skuSummary[row.SKU].lastUpdate = latestDate;\r\n    }\r\n    \r\n    // \u7D2F\u8BA1\u9500\u91CF\r\n    Object.keys(row).forEach(key => {\r\n      if (key.includes('_\u9500\u91CF')) {\r\n        skuSummary[row.SKU].totalSales += parseInt(row[key]) || 0;\r\n      }\r\n    });\r\n  });\r\n  \r\n  // \u5904\u7406\u8BB0\u5F55\u6570\u636E\r\n  recordsData.forEach(record => {\r\n    if (!record.SKU) return;\r\n    \r\n    if (!skuSummary[record.SKU]) {\r\n      skuSummary[record.SKU] = {\r\n        sku: record.SKU,\r\n        productName: record['\u4EA7\u54C1\u4E2D\u6587\u540D'] || '',\r\n        url: record['\u7F51\u9875\u94FE\u63A5'] || '',\r\n        initialStock: parseInt(record['\u521D\u59CB\u5E93\u5B58']) || 0,\r\n        currentStock: parseInt(record['\u5E93\u5B58']) || 0,\r\n        totalSales: parseInt(record['\u9500\u91CF']) || 0,\r\n        lastUpdate: record['\u65E5\u671F'] || ''\r\n      };\r\n    } else {\r\n      // \u66F4\u65B0\u6700\u65B0\u8BB0\u5F55\r\n      if (record['\u65E5\u671F'] > skuSummary[record.SKU].lastUpdate) {\r\n        skuSummary[record.SKU].currentStock = parseInt(record['\u5E93\u5B58']) || 0;\r\n        skuSummary[record.SKU].lastUpdate = record['\u65E5\u671F'] || '';\r\n      }\r\n      skuSummary[record.SKU].totalSales += parseInt(record['\u9500\u91CF']) || 0;\r\n    }\r\n  });\r\n  \r\n  return Object.values(skuSummary);\r\n}\r\n\r\n// \u751F\u6210\u6D4B\u8BD5\u5386\u53F2\u8BB0\u5F55\uFF08\u4E3A\u65B0\u5BFC\u5165\u7684\u6570\u636E\u521B\u5EFA\u4E00\u4E9B\u5386\u53F2\u6570\u636E\uFF09\r\nfunction generateTestHistoricalRecords(sampleRows) {\r\n  const testRecords = [];\r\n  const today = new Date();\r\n  \r\n  // \u4E3A\u6BCF\u4E2ASKU\u751F\u6210\u8FC7\u53BB30\u5929\u7684\u5386\u53F2\u6570\u636E\r\n  sampleRows.forEach(row => {\r\n    if (!row.SKU) return;\r\n    \r\n    for (let dayOffset = 30; dayOffset > 5; dayOffset--) {\r\n      const date = new Date(today);\r\n      date.setDate(today.getDate() - dayOffset);\r\n      const dateStr = date.toISOString().split('T')[0] + ' 12:00';\r\n      \r\n      const stock = Math.floor(Math.random() * 80) + 20; // 20-100\u5E93\u5B58\r\n      const sales = Math.floor(Math.random() * 5); // 0-4\u9500\u91CF\r\n      \r\n      testRecords.push({\r\n        id: Date.now() + Math.floor(Math.random() * 1000000),\r\n        SKU: row.SKU,\r\n        '\u4EA7\u54C1\u4E2D\u6587\u540D': row['\u4EA7\u54C1\u4E2D\u6587\u540D'] || '\u6D4B\u8BD5\u4EA7\u54C1',\r\n        '\u7F51\u9875\u94FE\u63A5': row['\u7F51\u9875\u94FE\u63A5'] || '',\r\n        '\u521D\u59CB\u5E93\u5B58': row['\u521D\u59CB\u5E93\u5B58'] || 100,\r\n        '\u65E5\u671F': dateStr,\r\n        '\u5E93\u5B58': stock,\r\n        '\u9500\u91CF': sales,\r\n        createTime: new Date().toISOString(),\r\n        createBy: 'auto-generated'\r\n      });\r\n    }\r\n  });\r\n  \r\n  return testRecords;\r\n}\r\n\r\n// \u5904\u7406\u4E0A\u4E0B\u67B6\u7BA1\u7406API\r\nasync function handleListingManagement(request, env, path, method, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u4E0A\u4E0B\u67B6\u7BA1\u7406\u8BF7\u6C42:', path);\r\n  \r\n  try {\r\n    if (path === '/api/listing/candidates' && method === 'GET') {\r\n      // \u83B7\u53D6\u5F85\u4E0A\u67B6\u5546\u54C1\u5019\u9009\r\n      const { wideData } = await getRealDataFromR2(env);\r\n      \r\n      const candidates = wideData.filter(row => {\r\n        // \u8BA1\u7B97\u5F53\u524D\u5E93\u5B58\r\n        const dates = Object.keys(row).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k)).sort();\r\n        const latestDate = dates[dates.length - 1];\r\n        const currentStock = latestDate ? (parseInt(row[latestDate]) || 0) : 0;\r\n        \r\n        // \u5E93\u5B58>10\u4E14\u72B6\u6001\u4E3A\u4E0B\u67B6\u6216\u672A\u8BBE\u7F6E\u72B6\u6001\r\n        return currentStock > 10 && (!row.status || row.status === 'offline');\r\n      }).map(row => {\r\n        const dates = Object.keys(row).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k)).sort();\r\n        const latestDate = dates[dates.length - 1];\r\n        const currentStock = latestDate ? (parseInt(row[latestDate]) || 0) : 0;\r\n        \r\n        return {\r\n          sku: row.SKU,\r\n          productName: row['\u4EA7\u54C1\u4E2D\u6587\u540D'],\r\n          currentStock: currentStock,\r\n          status: row.status || 'offline'\r\n        };\r\n      });\r\n      \r\n      return Response.json({\r\n        success: true,\r\n        data: candidates,\r\n        message: '\u83B7\u53D6\u5F85\u4E0A\u67B6\u5546\u54C1\u6210\u529F'\r\n      }, { headers: corsHeaders });\r\n      \r\n    } else if (path === '/api/delisting/candidates' && method === 'GET') {\r\n      // \u83B7\u53D6\u5F85\u4E0B\u67B6\u5546\u54C1\u5019\u9009\r\n      const { wideData } = await getRealDataFromR2(env);\r\n      \r\n      const candidates = wideData.filter(row => {\r\n        // \u8BA1\u7B97\u5F53\u524D\u5E93\u5B58\r\n        const dates = Object.keys(row).filter(k => /^\\d{4}-\\d{2}-\\d{2}$/.test(k)).sort();\r\n        const latestDate = dates[dates.length - 1];\r\n        const currentStock = latestDate ? (parseInt(row[latestDate]) || 0) : 0;\r\n        \r\n        // \u5E93\u5B58\u4E3A0\u4E14\u72B6\u6001\u4E3A\u4E0A\u67B6\r\n        return currentStock === 0 && row.status === 'online';\r\n      }).map(row => {\r\n        return {\r\n          sku: row.SKU,\r\n          productName: row['\u4EA7\u54C1\u4E2D\u6587\u540D'],\r\n          currentStock: 0,\r\n          status: row.status\r\n        };\r\n      });\r\n      \r\n      return Response.json({\r\n        success: true,\r\n        data: candidates,\r\n        message: '\u83B7\u53D6\u5F85\u4E0B\u67B6\u5546\u54C1\u6210\u529F'\r\n      }, { headers: corsHeaders });\r\n      \r\n    } else if (path === '/api/listing/confirm' && method === 'POST') {\r\n      // \u786E\u8BA4\u4E0A\u67B6\r\n      const { skus } = await request.json();\r\n      if (!Array.isArray(skus)) {\r\n        return Response.json({ \r\n          success: false, \r\n          error: 'SKU\u5217\u8868\u683C\u5F0F\u9519\u8BEF' \r\n        }, { status: 400, headers: corsHeaders });\r\n      }\r\n      \r\n      let updatedCount = 0;\r\n      wideTableCache.forEach(row => {\r\n        if (skus.includes(row.SKU)) {\r\n          row.status = 'online';\r\n          updatedCount++;\r\n        }\r\n      });\r\n      \r\n      // \u6301\u4E45\u5316\u5230R2\r\n      if (env.R2_BUCKET && wideTableCache.length > 0) {\r\n        try {\r\n          await env.R2_BUCKET.put(WIDE_TABLE_R2_KEY, JSON.stringify(wideTableCache), {\r\n            httpMetadata: { contentType: 'application/json' }\r\n          });\r\n        } catch (e) {\r\n          console.warn('\u4FDD\u5B58\u4E0A\u67B6\u72B6\u6001\u5230R2\u5931\u8D25:', e);\r\n        }\r\n      }\r\n      \r\n      return Response.json({\r\n        success: true,\r\n        message: `\u6210\u529F\u4E0A\u67B6 ${updatedCount} \u4E2A\u5546\u54C1`,\r\n        updatedCount: updatedCount\r\n      }, { headers: corsHeaders });\r\n      \r\n    } else if (path === '/api/delisting/confirm' && method === 'POST') {\r\n      // \u786E\u8BA4\u4E0B\u67B6\r\n      const { skus } = await request.json();\r\n      if (!Array.isArray(skus)) {\r\n        return Response.json({ \r\n          success: false, \r\n          error: 'SKU\u5217\u8868\u683C\u5F0F\u9519\u8BEF' \r\n        }, { status: 400, headers: corsHeaders });\r\n      }\r\n      \r\n      let updatedCount = 0;\r\n      wideTableCache.forEach(row => {\r\n        if (skus.includes(row.SKU)) {\r\n          row.status = 'offline';\r\n          updatedCount++;\r\n        }\r\n      });\r\n      \r\n      // \u6301\u4E45\u5316\u5230R2\r\n      if (env.R2_BUCKET && wideTableCache.length > 0) {\r\n        try {\r\n          await env.R2_BUCKET.put(WIDE_TABLE_R2_KEY, JSON.stringify(wideTableCache), {\r\n            httpMetadata: { contentType: 'application/json' }\r\n          });\r\n        } catch (e) {\r\n          console.warn('\u4FDD\u5B58\u4E0B\u67B6\u72B6\u6001\u5230R2\u5931\u8D25:', e);\r\n        }\r\n      }\r\n      \r\n      return Response.json({\r\n        success: true,\r\n        message: `\u6210\u529F\u4E0B\u67B6 ${updatedCount} \u4E2A\u5546\u54C1`,\r\n        updatedCount: updatedCount\r\n      }, { headers: corsHeaders });\r\n    }\r\n    \r\n    return Response.json({\r\n      success: false,\r\n      error: '\u4E0D\u652F\u6301\u7684\u4E0A\u4E0B\u67B6\u7BA1\u7406\u64CD\u4F5C'\r\n    }, { status: 404, headers: corsHeaders });\r\n    \r\n  } catch (error) {\r\n    console.error('\u4E0A\u4E0B\u67B6\u7BA1\u7406\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u5904\u7406\u6587\u4EF6\u91CD\u65B0\u7EC4\u7EC7API\u8BF7\u6C42\r\nasync function handleReorganization(request, env, path, method, corsHeaders) {\r\n  console.log('\uD83D\uDD04 \u5904\u7406\u6587\u4EF6\u91CD\u65B0\u7EC4\u7EC7\u8BF7\u6C42:', path);\r\n  \r\n  try {\r\n    if (path === '/api/reorganize/start' && method === 'POST') {\r\n      return await startReorganization(env, corsHeaders);\r\n    } else if (path === '/api/reorganize/status' && method === 'GET') {\r\n      return await getReorganizationStatus(env, corsHeaders);\r\n    } else if (path === '/api/reorganize/files' && method === 'GET') {\r\n      return await getFilesToReorganize(env, corsHeaders);\r\n    } else if (path.startsWith('/api/reorganize/move/') && method === 'POST') {\r\n      const fileKey = decodeURIComponent(path.replace('/api/reorganize/move/', ''));\r\n      return await moveFile(fileKey, env, corsHeaders);\r\n    } else if (path === '/api/reorganize/analyze' && method === 'GET') {\r\n      return await analyzeFiles(env, corsHeaders);\r\n    } else if (path === '/api/reorganize/reset' && method === 'POST') {\r\n      return await resetReorganization(env, corsHeaders);\r\n    } else if (path === '/api/reorganize/debug' && method === 'GET') {\r\n      return await debugReorganization(env, corsHeaders);\r\n    }\r\n    \r\n    return Response.json({\r\n      success: false,\r\n      error: '\u4E0D\u652F\u6301\u7684\u91CD\u65B0\u7EC4\u7EC7\u64CD\u4F5C'\r\n    }, { status: 404, headers: corsHeaders });\r\n    \r\n  } catch (error) {\r\n    console.error('\u6587\u4EF6\u91CD\u65B0\u7EC4\u7EC7\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u5F00\u59CB\u91CD\u65B0\u7EC4\u7EC7\u8FC7\u7A0B\r\nasync function startReorganization(env, corsHeaders) {\r\n  console.log('\uD83D\uDE80 \u5F00\u59CB\u6587\u4EF6\u91CD\u65B0\u7EC4\u7EC7...');\r\n  \r\n  try {\r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    // \u83B7\u53D6\u6570\u636E\u5E93\u6570\u636E\r\n    let databaseData = null;\r\n    try {\r\n      const dbObj = await env.R2_BUCKET.get('package-sync/database.json');\r\n      if (dbObj) {\r\n        const dbContent = await dbObj.json();\r\n        if (dbContent && dbContent.data) {\r\n          databaseData = new Map();\r\n          for (const record of dbContent.data) {\r\n            if (record.lp && record.contract) {\r\n              // \u5B58\u50A8LP\u53F7\u540E\u56DB\u4F4D\u5230\u5C65\u7EA6\u5355\u53F7\u7684\u6620\u5C04\r\n              const lpSuffix = record.lp.slice(-4); // \u53D6LP\u53F7\u540E\u56DB\u4F4D\r\n              databaseData.set(lpSuffix, record.contract);\r\n            }\r\n          }\r\n          console.log(`\uD83D\uDCCA \u52A0\u8F7D\u6570\u636E\u5E93\u6570\u636E: ${databaseData.size} \u6761\u8BB0\u5F55`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.warn('\u26A0\uFE0F \u65E0\u6CD5\u52A0\u8F7D\u6570\u636E\u5E93\u6570\u636E\uFF0C\u5C06\u4F7F\u7528LP\u53F7\u540E\u56DB\u4F4D\u4F5C\u4E3A\u5C65\u7EA6\u5355\u53F7:', error.message);\r\n    }\r\n\r\n    // \u83B7\u53D6\u6240\u6709\u6587\u4EF6\r\n    const allObjects = await env.R2_BUCKET.list({ limit: 1000 });\r\n    const filesToMove = [];\r\n    \r\n    // \u8BC6\u522B\u9700\u8981\u79FB\u52A8\u7684\u6587\u4EF6\uFF08\u53EA\u5904\u7406\u6253\u5305\u7CFB\u7EDF\u7684\u6587\u4EF6\uFF09\r\n    for (const obj of allObjects.objects) {\r\n      // \u8DF3\u8FC7\u5E93\u5B58\u7CFB\u7EDF\u6587\u4EF6\r\n      if (obj.key.startsWith('arc/') || \r\n          obj.key.startsWith('package-sync/') ||\r\n          obj.key.startsWith('wide/') ||\r\n          obj.key.startsWith('records/') ||\r\n          obj.key.startsWith('tmall/') ||\r\n          obj.key.startsWith('reorganization/')) {\r\n        continue;\r\n      }\r\n      \r\n      // \u68C0\u67E5\u662F\u5426\u4E3A\u56FE\u7247\u6216\u89C6\u9891\u6587\u4EF6\r\n      const isImageOrVideo = obj.httpMetadata?.contentType?.startsWith('image/') || \r\n                            obj.httpMetadata?.contentType?.startsWith('video/') ||\r\n                            obj.key.match(/\\.(jpg|jpeg|png|gif|mp4|avi|mov|webp)$/i);\r\n      \r\n      // \u68C0\u67E5\u662F\u5426\u4E3A\u9700\u8981\u91CD\u65B0\u7EC4\u7EC7\u7684\u6587\u4EF6\uFF1A\r\n      // 1. \u76F4\u63A5\u5B58\u50A8\u5728\u6839\u76EE\u5F55\u7684\u56FE\u7247\u548C\u89C6\u9891\u6587\u4EF6\r\n      // 2. \u5728package/\u6587\u4EF6\u5939\u4E2D\u4F46\u8DEF\u5F84\u4E0D\u6B63\u786E\u7684\u6587\u4EF6\uFF08\u9700\u8981\u91CD\u65B0\u7EC4\u7EC7\u5230\u6B63\u786E\u7684\u65E5\u671F\u6587\u4EF6\u5939\uFF09\r\n      // 3. \u4EE5\u65F6\u95F4\u6233\u547D\u540D\u7684\u6587\u4EF6\uFF08\u5982 1757513851798-887008722.jpg\uFF09\r\n      const isRootFile = !obj.key.includes('/');\r\n      const isInPackageButWrongPath = obj.key.startsWith('package/') && \r\n                                     !obj.key.match(/^package\\/\\d{4}-\\d{2}\\/\\d{4}-\\d{2}-\\d{2}\\/\\d{4}-\\d{2}-\\d{2}_\\d+\\//);\r\n      const isTimestampFile = obj.key.match(/^\\d{13,}-\\d+\\.(jpg|jpeg|png|gif|mp4|avi|mov|webp)$/i);\r\n      \r\n      if (isImageOrVideo && (isRootFile || isInPackageButWrongPath || isTimestampFile)) {\r\n        filesToMove.push({\r\n          key: obj.key,\r\n          size: obj.size,\r\n          uploaded: obj.uploaded,\r\n          contentType: obj.httpMetadata?.contentType || 'application/octet-stream'\r\n        });\r\n        console.log(`\uD83D\uDCC1 \u627E\u5230\u9700\u8981\u91CD\u65B0\u7EC4\u7EC7\u7684\u6587\u4EF6: ${obj.key}`);\r\n      }\r\n    }\r\n\r\n    console.log(`\uD83D\uDCCB \u627E\u5230 ${filesToMove.length} \u4E2A\u9700\u8981\u91CD\u65B0\u7EC4\u7EC7\u7684\u6587\u4EF6`);\r\n\r\n    // \u751F\u6210\u79FB\u52A8\u8BA1\u5212\r\n    const movePlan = filesToMove.map(file => {\r\n      const folderPath = generateNewPath(file.key, file.uploaded, databaseData);\r\n      const fileName = file.key.split('/').pop();\r\n      const newFilePath = `${folderPath}/${fileName}`;\r\n      return {\r\n        source: file.key,\r\n        destination: newFilePath,\r\n        size: file.size,\r\n        contentType: file.contentType\r\n      };\r\n    });\r\n\r\n    // \u5B58\u50A8\u79FB\u52A8\u8BA1\u5212\u5230R2\r\n    await env.R2_BUCKET.put('reorganization/plan.json', JSON.stringify({\r\n      plan: movePlan,\r\n      totalFiles: movePlan.length,\r\n      createdAt: new Date().toISOString(),\r\n      status: 'in_progress'\r\n    }), {\r\n      httpMetadata: { contentType: 'application/json' }\r\n    });\r\n\r\n    // \u5F00\u59CB\u5B9E\u9645\u79FB\u52A8\u6587\u4EF6\r\n    let movedCount = 0;\r\n    let errorCount = 0;\r\n    const errors = [];\r\n\r\n    console.log(`\uD83D\uDD04 \u5F00\u59CB\u79FB\u52A8 ${movePlan.length} \u4E2A\u6587\u4EF6...`);\r\n\r\n    for (const item of movePlan) {\r\n      try {\r\n        // \u68C0\u67E5\u6E90\u6587\u4EF6\u662F\u5426\u5B58\u5728\r\n        const sourceObj = await env.R2_BUCKET.get(item.source);\r\n        if (!sourceObj) {\r\n          console.warn(`\u26A0\uFE0F \u6E90\u6587\u4EF6\u4E0D\u5B58\u5728: ${item.source}`);\r\n          errorCount++;\r\n          errors.push(`\u6E90\u6587\u4EF6\u4E0D\u5B58\u5728: ${item.source}`);\r\n          continue;\r\n        }\r\n\r\n        // \u68C0\u67E5\u76EE\u6807\u6587\u4EF6\u662F\u5426\u5DF2\u5B58\u5728\r\n        const destObj = await env.R2_BUCKET.get(item.destination);\r\n        if (destObj) {\r\n          console.warn(`\u26A0\uFE0F \u76EE\u6807\u6587\u4EF6\u5DF2\u5B58\u5728: ${item.destination}`);\r\n          errorCount++;\r\n          errors.push(`\u76EE\u6807\u6587\u4EF6\u5DF2\u5B58\u5728: ${item.destination}`);\r\n          continue;\r\n        }\r\n\r\n        // \u79FB\u52A8\u6587\u4EF6\uFF08\u590D\u5236\u5230\u65B0\u4F4D\u7F6E\uFF0C\u7136\u540E\u5220\u9664\u539F\u6587\u4EF6\uFF09\r\n        await env.R2_BUCKET.put(item.destination, sourceObj.body, {\r\n          httpMetadata: sourceObj.httpMetadata,\r\n          customMetadata: {\r\n            ...sourceObj.customMetadata,\r\n            originalPath: item.source,\r\n            movedAt: new Date().toISOString()\r\n          }\r\n        });\r\n\r\n        // \u786E\u8BA4\u65B0\u6587\u4EF6\u521B\u5EFA\u6210\u529F\u540E\uFF0C\u5220\u9664\u539F\u6587\u4EF6\r\n        const verifyObj = await env.R2_BUCKET.get(item.destination);\r\n        if (verifyObj) {\r\n          await env.R2_BUCKET.delete(item.source);\r\n          movedCount++;\r\n          console.log(`\u2705 \u6587\u4EF6\u79FB\u52A8\u6210\u529F: ${item.source} -> ${item.destination}`);\r\n        } else {\r\n          throw new Error('\u65B0\u6587\u4EF6\u521B\u5EFA\u5931\u8D25\uFF0C\u53D6\u6D88\u79FB\u52A8\u64CD\u4F5C');\r\n        }\r\n\r\n      } catch (error) {\r\n        console.error(`\u274C \u79FB\u52A8\u6587\u4EF6\u5931\u8D25 ${item.source}:`, error);\r\n        errorCount++;\r\n        errors.push(`\u79FB\u52A8\u5931\u8D25 ${item.source}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    // \u66F4\u65B0\u8BA1\u5212\u72B6\u6001\r\n    await env.R2_BUCKET.put('reorganization/plan.json', JSON.stringify({\r\n      plan: movePlan,\r\n      totalFiles: movePlan.length,\r\n      movedFiles: movedCount,\r\n      errorCount: errorCount,\r\n      errors: errors,\r\n      createdAt: new Date().toISOString(),\r\n      status: 'completed'\r\n    }), {\r\n      httpMetadata: { contentType: 'application/json' }\r\n    });\r\n\r\n    console.log(`\uD83C\uDF89 \u6587\u4EF6\u91CD\u65B0\u7EC4\u7EC7\u5B8C\u6210: ${movedCount}/${movePlan.length} \u4E2A\u6587\u4EF6\u6210\u529F\u79FB\u52A8`);\r\n\r\n    return Response.json({\r\n      success: true,\r\n      message: `\u6587\u4EF6\u91CD\u65B0\u7EC4\u7EC7\u5B8C\u6210: ${movedCount}/${movePlan.length} \u4E2A\u6587\u4EF6\u6210\u529F\u79FB\u52A8`,\r\n      totalFiles: movePlan.length,\r\n      movedFiles: movedCount,\r\n      errorCount: errorCount,\r\n      errors: errors.slice(0, 5) // \u53EA\u8FD4\u56DE\u524D5\u4E2A\u9519\u8BEF\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u5F00\u59CB\u91CD\u65B0\u7EC4\u7EC7\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u83B7\u53D6\u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001\r\nasync function getReorganizationStatus(env, corsHeaders) {\r\n  try {\r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    const planObj = await env.R2_BUCKET.get('reorganization/plan.json');\r\n    if (!planObj) {\r\n      return Response.json({\r\n        success: true,\r\n        status: 'no_plan',\r\n        message: '\u6CA1\u6709\u627E\u5230\u91CD\u65B0\u7EC4\u7EC7\u8BA1\u5212'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    const plan = await planObj.json();\r\n    \r\n    // \u68C0\u67E5\u5B9E\u9645\u79FB\u52A8\u8FDB\u5EA6\r\n    let movedCount = 0;\r\n    for (const item of plan.plan) {\r\n      const destObj = await env.R2_BUCKET.get(item.destination);\r\n      if (destObj) {\r\n        movedCount++;\r\n      }\r\n    }\r\n\r\n    return Response.json({\r\n      success: true,\r\n      status: plan.status,\r\n      totalFiles: plan.totalFiles,\r\n      movedFiles: movedCount,\r\n      progress: plan.totalFiles > 0 ? Math.round((movedCount / plan.totalFiles) * 100) : 0,\r\n      createdAt: plan.createdAt\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u83B7\u53D6\u72B6\u6001\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u83B7\u53D6\u9700\u8981\u91CD\u65B0\u7EC4\u7EC7\u7684\u6587\u4EF6\u5217\u8868\r\nasync function getFilesToReorganize(env, corsHeaders) {\r\n  try {\r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    const planObj = await env.R2_BUCKET.get('reorganization/plan.json');\r\n    if (!planObj) {\r\n      return Response.json({\r\n        success: false,\r\n        message: '\u6CA1\u6709\u627E\u5230\u91CD\u65B0\u7EC4\u7EC7\u8BA1\u5212\uFF0C\u8BF7\u5148\u8C03\u7528 /api/reorganize/start'\r\n      }, { headers: corsHeaders });\r\n    }\r\n\r\n    const plan = await planObj.json();\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      files: plan.plan,\r\n      total: plan.totalFiles\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u83B7\u53D6\u6587\u4EF6\u5217\u8868\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u5206\u6790\u6587\u4EF6\u7C7B\u578B\r\nasync function analyzeFiles(env, corsHeaders) {\r\n  try {\r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    // \u83B7\u53D6\u6240\u6709\u6587\u4EF6\r\n    const allObjects = await env.R2_BUCKET.list({ limit: 1000 });\r\n    \r\n    // \u5206\u7C7B\u6587\u4EF6\r\n    const categories = {\r\n      inventorySystem: [], // \u5E93\u5B58\u7CFB\u7EDF\u6587\u4EF6\r\n      packageSystem: [],   // \u6253\u5305\u7CFB\u7EDF\u6587\u4EF6\r\n      other: []            // \u5176\u4ED6\u6587\u4EF6\r\n    };\r\n    \r\n    for (const obj of allObjects.objects) {\r\n      const key = obj.key;\r\n      \r\n      // \u8DF3\u8FC7\u91CD\u7EC4\u76F8\u5173\u7684\u4E34\u65F6\u6587\u4EF6\r\n      if (key === 'reorganization/plan.json' || key.startsWith('reorganization/temp/')) {\r\n        continue;\r\n      }\r\n      \r\n      // \u5E93\u5B58\u7CFB\u7EDF\u6587\u4EF6\r\n      if (key.startsWith('arc/') || \r\n          key.startsWith('package-sync/') ||\r\n          key.startsWith('wide/') ||\r\n          key.startsWith('records/') ||\r\n          key.startsWith('tmall/')) {\r\n        categories.inventorySystem.push({\r\n          key: key,\r\n          size: obj.size,\r\n          uploaded: obj.uploaded,\r\n          contentType: obj.httpMetadata?.contentType || 'application/octet-stream'\r\n        });\r\n      }\r\n      // \u6253\u5305\u7CFB\u7EDF\u6587\u4EF6\uFF08\u9700\u8981\u91CD\u65B0\u7EC4\u7EC7\uFF09\r\n      else if (key.startsWith('package/') ||\r\n               key.match(/^\\d{8}_[^/]+\\//) ||\r\n               (key.match(/\\.(jpg|jpeg|png|gif|mp4|avi|mov)$/i) && !key.includes('/'))) {\r\n        categories.packageSystem.push({\r\n          key: key,\r\n          size: obj.size,\r\n          uploaded: obj.uploaded,\r\n          contentType: obj.httpMetadata?.contentType || 'application/octet-stream'\r\n        });\r\n      }\r\n      // \u5176\u4ED6\u6587\u4EF6\r\n      else {\r\n        categories.other.push({\r\n          key: key,\r\n          size: obj.size,\r\n          uploaded: obj.uploaded,\r\n          contentType: obj.httpMetadata?.contentType || 'application/octet-stream'\r\n        });\r\n      }\r\n    }\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      categories: categories,\r\n      summary: {\r\n        inventorySystem: categories.inventorySystem.length,\r\n        packageSystem: categories.packageSystem.length,\r\n        other: categories.other.length,\r\n        total: categories.inventorySystem.length + categories.packageSystem.length + categories.other.length\r\n      }\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u5206\u6790\u6587\u4EF6\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u79FB\u52A8\u5355\u4E2A\u6587\u4EF6\r\nasync function moveFile(fileKey, env, corsHeaders) {\r\n  try {\r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    // \u83B7\u53D6\u539F\u6587\u4EF6\r\n    const sourceObj = await env.R2_BUCKET.get(fileKey);\r\n    if (!sourceObj) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u6E90\u6587\u4EF6\u4E0D\u5B58\u5728'\r\n      }, { status: 404, headers: corsHeaders });\r\n    }\r\n\r\n    // \u751F\u6210\u65B0\u8DEF\u5F84\uFF08\u6587\u4EF6\u5939\u8DEF\u5F84\uFF09\r\n    const folderPath = generateNewPath(fileKey, sourceObj.uploaded);\r\n    \r\n    // \u4ECE\u539F\u6587\u4EF6\u8DEF\u5F84\u4E2D\u63D0\u53D6\u6587\u4EF6\u540D\r\n    const fileName = fileKey.split('/').pop();\r\n    const newFilePath = `${folderPath}/${fileName}`;\r\n    \r\n    // \u68C0\u67E5\u76EE\u6807\u6587\u4EF6\u662F\u5426\u5DF2\u5B58\u5728\r\n    const destObj = await env.R2_BUCKET.get(newFilePath);\r\n    if (destObj) {\r\n      return Response.json({\r\n        success: false,\r\n        error: '\u76EE\u6807\u6587\u4EF6\u5DF2\u5B58\u5728'\r\n      }, { status: 409, headers: corsHeaders });\r\n    }\r\n\r\n    // \u79FB\u52A8\u6587\u4EF6\u5230\u65B0\u4F4D\u7F6E\uFF08\u5148\u590D\u5236\uFF0C\u518D\u5220\u9664\uFF09\r\n    await env.R2_BUCKET.put(newFilePath, sourceObj.body, {\r\n      httpMetadata: sourceObj.httpMetadata,\r\n      customMetadata: {\r\n        ...sourceObj.customMetadata,\r\n        originalPath: fileKey,\r\n        movedAt: new Date().toISOString()\r\n      }\r\n    });\r\n\r\n    // \u786E\u8BA4\u65B0\u6587\u4EF6\u521B\u5EFA\u6210\u529F\u540E\uFF0C\u5220\u9664\u539F\u6587\u4EF6\r\n    const verifyObj = await env.R2_BUCKET.get(newFilePath);\r\n    if (verifyObj) {\r\n      await env.R2_BUCKET.delete(fileKey);\r\n      console.log(`\u2705 \u6587\u4EF6\u79FB\u52A8\u6210\u529F: ${fileKey} -> ${newFilePath}`);\r\n    } else {\r\n      throw new Error('\u65B0\u6587\u4EF6\u521B\u5EFA\u5931\u8D25\uFF0C\u53D6\u6D88\u79FB\u52A8\u64CD\u4F5C');\r\n    }\r\n\r\n    return Response.json({\r\n      success: true,\r\n      message: '\u6587\u4EF6\u79FB\u52A8\u6210\u529F',\r\n      source: fileKey,\r\n      destination: newFilePath\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u79FB\u52A8\u6587\u4EF6\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u751F\u6210\u65B0\u7684\u6587\u4EF6\u8DEF\u5F84\r\nfunction generateNewPath(fileName, uploadTime, databaseData = null) {\r\n  // \u5C1D\u8BD5\u4ECE\u6587\u4EF6\u540D\u63D0\u53D6\u65E5\u671F\u548CLP\u53F7\u540E\u56DB\u4F4D\uFF08\u683C\u5F0F\uFF1A20250901_0441\uFF09\r\n  const dateLpMatch = fileName.match(/^(\\d{8})_(\\d{4})/);\r\n  \r\n  if (dateLpMatch) {\r\n    const dateStr = dateLpMatch[1];\r\n    const lpSuffix = dateLpMatch[2];\r\n    \r\n    // \u5C06YYYYMMDD\u8F6C\u6362\u4E3AYYYY-MM-DD\u683C\u5F0F\r\n    const year = dateStr.substring(0, 4);\r\n    const month = dateStr.substring(4, 6);\r\n    const day = dateStr.substring(6, 8);\r\n    const yearMonth = `${year}-${month}`;\r\n    const yearMonthDay = `${year}-${month}-${day}`;\r\n    \r\n    // \u67E5\u627E\u5BF9\u5E94\u7684\u5C65\u7EA6\u5355\u53F7\r\n    let contractNumber = lpSuffix; // \u9ED8\u8BA4\u4F7F\u7528LP\u53F7\u540E\u56DB\u4F4D\r\n    \r\n    if (databaseData && databaseData.has(lpSuffix)) {\r\n      contractNumber = databaseData.get(lpSuffix); // \u4F7F\u7528\u627E\u5230\u7684\u5C65\u7EA6\u5355\u53F7\r\n      console.log(`\uD83D\uDD0D \u627E\u5230\u5339\u914D: LP\u53F7\u540E\u56DB\u4F4D ${lpSuffix} -> \u5C65\u7EA6\u5355\u53F7 ${contractNumber}`);\r\n    } else {\r\n      console.log(`\u26A0\uFE0F \u672A\u627E\u5230\u5339\u914D: LP\u53F7\u540E\u56DB\u4F4D ${lpSuffix}\uFF0C\u4F7F\u7528LP\u53F7\u540E\u56DB\u4F4D\u4F5C\u4E3A\u6587\u4EF6\u5939\u540D\uFF08\u7528\u6237\u5C06\u624B\u52A8\u5904\u7406\uFF09`);\r\n    }\r\n    \r\n    // \u53EA\u8FD4\u56DE\u6587\u4EF6\u5939\u8DEF\u5F84\uFF0C\u4E0D\u5305\u542B\u6587\u4EF6\u540D\r\n    return `package/${yearMonth}/${yearMonthDay}/${yearMonthDay}_${contractNumber}`;\r\n  }\r\n  \r\n  // \u5C1D\u8BD5\u4ECE\u65F6\u95F4\u6233\u6587\u4EF6\u540D\u63D0\u53D6\u4FE1\u606F\uFF08\u683C\u5F0F\uFF1A1757513851798-887008722.jpg\uFF09\r\n  const timestampMatch = fileName.match(/^(\\d{13,})-(\\d+)\\./);\r\n  if (timestampMatch) {\r\n    const timestamp = parseInt(timestampMatch[1]);\r\n    const fileId = timestampMatch[2];\r\n    \r\n    // \u4F7F\u7528\u65F6\u95F4\u6233\u63A8\u65AD\u65E5\u671F\r\n    const uploadDate = new Date(timestamp);\r\n    const year = uploadDate.getFullYear();\r\n    const month = String(uploadDate.getMonth() + 1).padStart(2, '0');\r\n    const day = String(uploadDate.getDate()).padStart(2, '0');\r\n    const yearMonth = `${year}-${month}`;\r\n    const yearMonthDay = `${year}-${month}-${day}`;\r\n    \r\n    // \u5C1D\u8BD5\u4ECE\u6587\u4EF6ID\u4E2D\u63D0\u53D6LP\u53F7\u540E\u56DB\u4F4D\uFF08\u53D6\u6700\u540E4\u4F4D\uFF09\r\n    const lpSuffix = fileId.slice(-4);\r\n    let contractNumber = lpSuffix; // \u9ED8\u8BA4\u4F7F\u7528\u6587\u4EF6ID\u540E\u56DB\u4F4D\r\n    \r\n    // \u5C1D\u8BD5\u5728\u6570\u636E\u5E93\u4E2D\u67E5\u627E\u5BF9\u5E94\u7684\u5C65\u7EA6\u5355\u53F7\r\n    if (databaseData && databaseData.has(lpSuffix)) {\r\n      contractNumber = databaseData.get(lpSuffix);\r\n      console.log(`\uD83D\uDD0D \u627E\u5230\u5339\u914D: \u6587\u4EF6ID\u540E\u56DB\u4F4D ${lpSuffix} -> \u5C65\u7EA6\u5355\u53F7 ${contractNumber}`);\r\n    } else {\r\n      console.log(`\u26A0\uFE0F \u672A\u627E\u5230\u5339\u914D: \u6587\u4EF6ID\u540E\u56DB\u4F4D ${lpSuffix}\uFF0C\u4F7F\u7528\u6587\u4EF6ID\u540E\u56DB\u4F4D\u4F5C\u4E3A\u6587\u4EF6\u5939\u540D`);\r\n    }\r\n    \r\n    return `package/${yearMonth}/${yearMonthDay}/${yearMonthDay}_${contractNumber}`;\r\n  }\r\n  \r\n  // \u5982\u679C\u6CA1\u6709\u5339\u914D\u5230\u4EFB\u4F55\u6A21\u5F0F\uFF0C\u4F7F\u7528\u4E0A\u4F20\u65F6\u95F4\u63A8\u65AD\u65E5\u671F\r\n  const uploadDate = new Date(uploadTime);\r\n  const year = uploadDate.getFullYear();\r\n  const month = String(uploadDate.getMonth() + 1).padStart(2, '0');\r\n  const day = String(uploadDate.getDate()).padStart(2, '0');\r\n  const yearMonth = `${year}-${month}`;\r\n  const yearMonthDay = `${year}-${month}-${day}`;\r\n  \r\n  // \u4ECE\u6587\u4EF6\u540D\u4E2D\u63D0\u53D6\u53EF\u80FD\u7684\u6570\u5B57\u4F5C\u4E3A\u9ED8\u8BA4\u5C65\u7EA6\u5355\u53F7\r\n  const numberMatch = fileName.match(/(\\d{4,})/);\r\n  const defaultContract = numberMatch ? numberMatch[1].slice(-4) : 'UNKNOWN';\r\n  \r\n  console.log(`\uD83D\uDCC5 \u4F7F\u7528\u4E0A\u4F20\u65F6\u95F4\u63A8\u65AD\u65E5\u671F: ${yearMonthDay}, \u9ED8\u8BA4\u5C65\u7EA6\u5355\u53F7: ${defaultContract}`);\r\n  \r\n  return `package/${yearMonth}/${yearMonthDay}/${yearMonthDay}_${defaultContract}`;\r\n}\r\n\r\n// \u91CD\u7F6E\u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001\r\nasync function resetReorganization(env, corsHeaders) {\r\n  try {\r\n    console.log('\uD83D\uDD04 \u91CD\u7F6E\u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001...');\r\n    \r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    // \u5220\u9664\u73B0\u6709\u7684\u8BA1\u5212\u6587\u4EF6\r\n    await env.R2_BUCKET.delete('reorganization/plan.json');\r\n    \r\n    console.log('\u2705 \u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001\u5DF2\u91CD\u7F6E');\r\n    \r\n    return Response.json({\r\n      success: true,\r\n      message: '\u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001\u5DF2\u91CD\u7F6E\uFF0C\u53EF\u4EE5\u91CD\u65B0\u5F00\u59CB'\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u91CD\u7F6E\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n\r\n// \u8C03\u8BD5\u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001\r\nasync function debugReorganization(env, corsHeaders) {\r\n  try {\r\n    console.log('\uD83D\uDD0D \u8C03\u8BD5\u91CD\u65B0\u7EC4\u7EC7\u72B6\u6001...');\r\n    \r\n    if (!env.R2_BUCKET) {\r\n      throw new Error('R2\u5B58\u50A8\u6876\u4E0D\u53EF\u7528');\r\n    }\r\n\r\n    const debugInfo = {\r\n      timestamp: new Date().toISOString(),\r\n      planExists: false,\r\n      planData: null,\r\n      actualFiles: [],\r\n      movedFiles: [],\r\n      errors: []\r\n    };\r\n\r\n    // \u68C0\u67E5\u8BA1\u5212\u6587\u4EF6\r\n    try {\r\n      const planObj = await env.R2_BUCKET.get('reorganization/plan.json');\r\n      if (planObj) {\r\n        debugInfo.planExists = true;\r\n        debugInfo.planData = await planObj.json();\r\n      }\r\n    } catch (error) {\r\n      debugInfo.errors.push(`\u8BA1\u5212\u6587\u4EF6\u8BFB\u53D6\u9519\u8BEF: ${error.message}`);\r\n    }\r\n\r\n    // \u68C0\u67E5\u5B9E\u9645\u6587\u4EF6\u72B6\u6001\r\n    try {\r\n      const allObjects = await env.R2_BUCKET.list({ limit: 1000 });\r\n      debugInfo.actualFiles = allObjects.objects.map(obj => ({\r\n        key: obj.key,\r\n        size: obj.size,\r\n        uploaded: obj.uploaded,\r\n        contentType: obj.httpMetadata?.contentType\r\n      }));\r\n    } catch (error) {\r\n      debugInfo.errors.push(`\u6587\u4EF6\u5217\u8868\u8BFB\u53D6\u9519\u8BEF: ${error.message}`);\r\n    }\r\n\r\n    // \u5982\u679C\u6709\u8BA1\u5212\uFF0C\u68C0\u67E5\u79FB\u52A8\u72B6\u6001\r\n    if (debugInfo.planData && debugInfo.planData.plan) {\r\n      for (const item of debugInfo.planData.plan) {\r\n        try {\r\n          const destObj = await env.R2_BUCKET.get(item.destination);\r\n          const sourceObj = await env.R2_BUCKET.get(item.source);\r\n          \r\n          debugInfo.movedFiles.push({\r\n            source: item.source,\r\n            destination: item.destination,\r\n            sourceExists: !!sourceObj,\r\n            destinationExists: !!destObj,\r\n            status: destObj ? 'moved' : (sourceObj ? 'not_moved' : 'missing')\r\n          });\r\n        } catch (error) {\r\n          debugInfo.errors.push(`\u68C0\u67E5\u6587\u4EF6 ${item.source} \u9519\u8BEF: ${error.message}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    return Response.json({\r\n      success: true,\r\n      debug: debugInfo\r\n    }, { headers: corsHeaders });\r\n\r\n  } catch (error) {\r\n    console.error('\u274C \u8C03\u8BD5\u5931\u8D25:', error);\r\n    return Response.json({\r\n      success: false,\r\n      error: error.message\r\n    }, { status: 500, headers: corsHeaders });\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["year", "month", "day", "yearMonth", "yearMonthDay", "uploadDate"]
}
