<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Excelæ•°æ®æŸ¥çœ‹å™¨ - æ•°æ®ç®¡ç†ç³»ç»Ÿ</title>
  <link href="./src/css/layui.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header .layui-nav {
      background: transparent;
    }
    .header .layui-nav .layui-nav-item a {
      color: rgba(255,255,255,0.9);
    }
    .header .layui-nav .layui-nav-item a:hover {
      color: white;
    }
    .header .logo {
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
    }
    
    /* ä¸»å¯¼èˆªæ ·å¼ */
    .main-nav {
      flex: 1;
      display: flex;
      justify-content: center;
      margin: 0 20px;
    }
    .main-nav .layui-nav-item {
      margin: 0 5px;
    }
    .main-nav .layui-nav-item a {
      padding: 0 20px;
      border-radius: 6px;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    .main-nav .layui-nav-item a:hover,
    .main-nav .layui-nav-item.layui-this a {
      background: rgba(255,255,255,0.2);
      color: white;
    }
    .main-nav .layui-nav-item a i {
      margin-right: 6px;
    }
    
    .header .user-info {
      white-space: nowrap;
    }
    
    /* ç”¨æˆ·ä¸‹æ‹‰èœå•æ ·å¼ */
    .user-info .layui-nav-child dd a {
      padding: 10px 15px;
      color: #666;
      transition: all 0.3s ease;
    }
    .user-info .layui-nav-child dd a:hover {
      background: #f8f9fa;
      color: #16baaa;
    }
    .user-info .layui-nav-child dd a i {
      margin-right: 8px;
      font-size: 14px;
    }
    
    .content-wrapper {
      padding: 20px;
    }
    
    .page-header {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .page-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin: 0;
    }
    .page-subtitle {
      color: #666;
      margin-top: 5px;
    }
    .breadcrumb {
      color: #999;
      font-size: 14px;
      margin-top: 10px;
    }
    .breadcrumb a {
      color: #16baaa;
      text-decoration: none;
    }
    
    .control-panel {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      padding: 20px;
    }
    
    .sheet-tabs {
      margin-bottom: 20px;
    }
    .sheet-tab {
      display: inline-block;
      padding: 10px 20px;
      margin-right: 10px;
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .sheet-tab:hover {
      background: #e9ecef;
    }
    .sheet-tab.active {
      background: #16baaa;
      color: white;
      border-color: #16baaa;
    }
    
    .file-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .file-info h4 {
      margin: 0 0 10px 0;
      color: #333;
    }
    .file-info .info-item {
      display: inline-block;
      margin-right: 20px;
      color: #666;
      font-size: 14px;
    }
    
    .table-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .table-header {
      padding: 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .table-stats {
      font-size: 14px;
      color: #666;
    }
    .table-stats strong {
      color: #333;
    }
    
    .excel-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .excel-table th {
      background: #f8f9fa;
      padding: 12px 8px;
      border: 1px solid #e6e6e6;
      font-weight: bold;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .excel-table td {
      padding: 10px 8px;
      border: 1px solid #e6e6e6;
      text-align: center;
      background: white;
      min-width: 80px;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .excel-table tr:nth-child(even) td {
      background: #fafafa;
    }
    .excel-table tr:hover td {
      background: #e6f7ff;
    }
    
    .pagination-wrapper {
      padding: 20px;
      text-align: center;
      border-top: 1px solid #f0f0f0;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #999;
    }
    .loading i {
      font-size: 32px;
      margin-bottom: 10px;
      display: block;
    }
    
    .table-wrapper {
      overflow-x: auto;
      max-height: 70vh;
      overflow-y: auto;
    }
    
    .actions {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="layui-header header">
    <div class="logo">
      ğŸ“Š æ•°æ®ç®¡ç†ç³»ç»Ÿ
    </div>
    
    <!-- ä¸»å¯¼èˆªæŒ‰é’® -->
    <ul class="layui-nav main-nav">
      <li class="layui-nav-item">
        <a href="dashboard.html">
          <i class="layui-icon layui-icon-home"></i> æ•°æ®ä»ªè¡¨ç›˜
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="table-management.html">
          <i class="layui-icon layui-icon-table"></i> è¡¨æ ¼ç®¡ç†
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="data-upload.html">
          <i class="layui-icon layui-icon-upload-drag"></i> æ•°æ®å¯¼å…¥
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="data-analysis.html">
          <i class="layui-icon layui-icon-chart"></i> æ•°æ®åˆ†æ
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="local-database.html">
          <i class="layui-icon layui-icon-database"></i> æœ¬åœ°æ•°æ®åº“
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="tmall-database.html">
          <i class="layui-icon layui-icon-cart"></i> å¤©çŒ«æ•°æ®åº“
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="tmall-order.html">
          <i class="layui-icon layui-icon-list"></i> å¤©çŒ«è®¢å•
        </a>
      </li>
      <li class="layui-nav-item" id="adminOnlyTopNav" style="display: none;">
        <a href="user-management.html">
          <i class="layui-icon layui-icon-username"></i> ç”¨æˆ·ç®¡ç†
        </a>
      </li>
    </ul>
    
    
  </div>
  
  <div class="content-wrapper">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">ğŸ“ˆ Excelæ•°æ®æŸ¥çœ‹å™¨</h1>
      <p class="page-subtitle">æŸ¥çœ‹å’Œåˆ†ææ‚¨çš„Excelæ–‡ä»¶æ•°æ®</p>
      <div class="breadcrumb">
        <a href="dashboard.html">é¦–é¡µ</a> / <a href="table-management.html">è¡¨æ ¼ç®¡ç†</a> / ExcelæŸ¥çœ‹å™¨
      </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <!-- æ–‡ä»¶ä¿¡æ¯ -->
      <div class="file-info" id="fileInfo" style="display: none;">
        <h4 id="fileName">æ–‡ä»¶å</h4>
        <div>
          <span class="info-item" id="fileSize">å¤§å°: -</span>
          <span class="info-item" id="uploadTime">ä¸Šä¼ æ—¶é—´: -</span>
          <span class="info-item" id="uploadedBy">ä¸Šä¼ è€…: -</span>
          <span class="info-item" id="totalSheets">å·¥ä½œè¡¨æ•°: -</span>
        </div>
      </div>
      
      <!-- å·¥ä½œè¡¨é€‰æ‹© -->
      <div class="sheet-tabs" id="sheetTabs" style="display: none;">
        <!-- åŠ¨æ€ç”Ÿæˆå·¥ä½œè¡¨æ ‡ç­¾ -->
      </div>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <div class="actions">
        <button class="layui-btn layui-btn-primary" onclick="goBack()">
          <i class="layui-icon layui-icon-return"></i> è¿”å›
        </button>
        <button class="layui-btn layui-btn-normal" onclick="downloadFile()">
          <i class="layui-icon layui-icon-download-circle"></i> ä¸‹è½½æ–‡ä»¶
        </button>
        <button class="layui-btn" onclick="refreshData()">
          <i class="layui-icon layui-icon-refresh-3"></i> åˆ·æ–°æ•°æ®
        </button>
      </div>
    </div>
    
    <!-- æ•°æ®è¡¨æ ¼ -->
    <div class="table-container">
      <div class="table-header">
        <div class="table-stats">
          <span>å½“å‰å·¥ä½œè¡¨: <strong id="currentSheetName">-</strong></span>
          <span style="margin-left: 20px;">å…± <strong id="totalRows">0</strong> è¡Œæ•°æ®</span>
          <span style="margin-left: 20px;">ç¬¬ <strong id="currentPage">1</strong> / <strong id="totalPages">1</strong> é¡µ</span>
        </div>
        <div>
          <span style="font-size: 14px; color: #666;">æ¯é¡µæ˜¾ç¤º 20 è¡Œ</span>
        </div>
      </div>
      
      <div class="table-wrapper">
        <div class="loading" id="loading">
          <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i>
          <div>æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>
        
        <table class="excel-table" id="dataTable" style="display: none;">
          <thead id="tableHeader">
            <!-- åŠ¨æ€ç”Ÿæˆè¡¨å¤´ -->
          </thead>
          <tbody id="tableBody">
            <!-- åŠ¨æ€ç”Ÿæˆè¡¨æ ¼æ•°æ® -->
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper">
        <div id="pagination"></div>
      </div>
    </div>
  </div>

  <script src="./src/layui.js"></script>
  <script>
    layui.use(['layer', 'laypage'], function(){
      var layer = layui.layer;
      var laypage = layui.laypage;
      
      var userInfo = JSON.parse(localStorage.getItem('currentUser') || '{}');
      var currentFileId = null;
      var currentSheet = null;
      var currentPage = 1;
      var allSheets = [];
      
      // åˆå§‹åŒ–é¡µé¢
      initPage();
      
      function initPage() {
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (!userInfo.username) {
          layer.msg('è¯·å…ˆç™»å½•ï¼', {icon: 2}, function(){
            window.location.href = 'login.html';
          });
          return;
        }
        
        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
        var cu = document.getElementById('currentUser');
        if (cu) cu.textContent = userInfo.realname || userInfo.username;
        
        // æ ¹æ®è§’è‰²æ˜¾ç¤ºå¯¼èˆª
        if (userInfo.role === 'admin') {
          document.getElementById('adminOnlyTopNav').style.display = 'block';
        }
        
        // è·å–URLå‚æ•°ä¸­çš„æ–‡ä»¶ID
        var urlParams = new URLSearchParams(window.location.search);
        currentFileId = urlParams.get('fileId');
        
        if (!currentFileId) {
          layer.msg('æœªæŒ‡å®šæ–‡ä»¶IDï¼', {icon: 2}, function(){
            window.location.href = 'table-management.html';
          });
          return;
        }
        
        // åŠ è½½æ–‡ä»¶æ•°æ®
        loadFileData();
      }
      
      function loadFileData() {
        if (!currentFileId) return;
        
        showLoading(true);
        
        var url = '/api/files/' + currentFileId + '/analyze';
        var params = new URLSearchParams();
        
        if (currentSheet) {
          params.append('sheet', currentSheet);
        }
        
        if (currentPage > 1) {
          params.append('page', currentPage);
        }
        
        params.append('limit', '20');
        
        url += '?' + params.toString();
        
        var token = userInfo.token || localStorage.getItem('token');
        var headers = {};
        
        if (token) {
          headers['Authorization'] = 'Bearer ' + token;
        }
        
        fetch(url, {
          headers: headers
        })
        .then(response => {
          console.log('APIå“åº”çŠ¶æ€:', response.status);
          if (!response.ok) {
            throw new Error('HTTP ' + response.status);
          }
          return response.json();
        })
        .then(data => {
          console.log('æ”¶åˆ°æ•°æ®:', data);
          if (data.success) {
            try {
              displayFileData(data.analysis);
            } catch (renderError) {
              console.error('æ•°æ®æ¸²æŸ“é”™è¯¯:', renderError);
              layer.msg('æ•°æ®æ¸²æŸ“å¤±è´¥ï¼Œæ•°æ®é‡è¿‡å¤§: ' + renderError.message, {icon: 2});
            }
          } else {
            layer.msg('åŠ è½½æ•°æ®å¤±è´¥: ' + data.error, {icon: 2});
          }
        })
        .catch(error => {
          console.error('åŠ è½½é”™è¯¯:', error);
          layer.msg('åŠ è½½å¤±è´¥: ' + error.message, {icon: 2});
        })
        .finally(() => {
          showLoading(false);
        });
      }
      
      function displayFileData(analysis) {
        // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
        document.getElementById('fileName').textContent = analysis.fileName;
        document.getElementById('fileSize').textContent = 'å¤§å°: ' + formatFileSize(analysis.summary.fileSize);
        document.getElementById('uploadTime').textContent = 'ä¸Šä¼ æ—¶é—´: ' + formatDateTime(analysis.summary.uploadTime);
        document.getElementById('uploadedBy').textContent = 'ä¸Šä¼ è€…: ' + analysis.summary.uploadedBy;
        document.getElementById('totalSheets').textContent = 'å·¥ä½œè¡¨æ•°: ' + analysis.summary.totalSheets;
        document.getElementById('fileInfo').style.display = 'block';
        
        // ä¿å­˜å·¥ä½œè¡¨ä¿¡æ¯
        allSheets = analysis.allSheets;
        currentSheet = analysis.currentSheet;
        
        // æ˜¾ç¤ºå·¥ä½œè¡¨é€‰é¡¹å¡
        displaySheetTabs(analysis.allSheets, analysis.currentSheet);
        
        // æ˜¾ç¤ºæ•°æ®è¡¨æ ¼
        displayDataTable(analysis);
        
        // æ˜¾ç¤ºåˆ†é¡µ
        if (analysis.pagination) {
          displayPagination(analysis.pagination);
        }
      }
      
      function displaySheetTabs(sheets, activeSheet) {
        var tabsHtml = '';
        sheets.forEach(function(sheet) {
          var activeClass = sheet.name === activeSheet ? 'active' : '';
          tabsHtml += '<div class="sheet-tab ' + activeClass + '" onclick="switchSheet(\'' + 
                      sheet.name + '\')">' + sheet.name + ' (' + sheet.rowCount + ' è¡Œ)</div>';
        });
        
        document.getElementById('sheetTabs').innerHTML = tabsHtml;
        document.getElementById('sheetTabs').style.display = 'block';
      }
      
      function displayDataTable(analysis) {
        console.log('å¼€å§‹æ¸²æŸ“æ•°æ®è¡¨æ ¼...');
        console.log('æ•°æ®è¡Œæ•°:', analysis.data ? analysis.data.length : 0);
        console.log('åˆ—æ•°:', analysis.headers ? analysis.headers.length : 0);
        
        var headers = analysis.headers || [];
        var data = analysis.data || [];
        
        // ç”Ÿæˆè¡¨å¤´ï¼ˆä¸è¡¨æ ¼æ•°æ®ä¿æŒä¸€è‡´çš„åˆ—æ•°é™åˆ¶ï¼‰
        var maxColsToShow = Math.min(headers.length, 30);
        var headerParts = ['<tr>'];
        
        for (var index = 0; index < maxColsToShow; index++) {
          var header = headers[index] || 'æœªå‘½å';
          headerParts.push('<th>ç¬¬' + (index + 1) + 'åˆ—<br>' + header + '</th>');
        }
        
        if (headers.length > maxColsToShow) {
          headerParts.push('<th style="color:#999;">... (' + (headers.length - maxColsToShow) + ' åˆ—)</th>');
        }
        
        headerParts.push('</tr>');
        document.getElementById('tableHeader').innerHTML = headerParts.join('');
        
        // ä¼˜åŒ–çš„è¡¨æ ¼æ¸²æŸ“ - ä½¿ç”¨DocumentFragmentæå‡æ€§èƒ½
        console.log('å¼€å§‹æ¸²æŸ“è¡¨æ ¼è¡Œ...');
        var maxRowsToShow = Math.min(data.length, 50); // å‡å°‘åˆ°50è¡Œï¼Œæå‡é€Ÿåº¦
        var maxColsToShow = Math.min(headers.length, 30); // å‡å°‘åˆ°30åˆ—ï¼Œæå‡é€Ÿåº¦
        
        // ä½¿ç”¨æ•°ç»„æ‹¼æ¥è€Œä¸æ˜¯å­—ç¬¦ä¸²è¿æ¥ï¼Œæ€§èƒ½æ›´å¥½
        var bodyParts = [];
        
        for (var rowIndex = 0; rowIndex < maxRowsToShow; rowIndex++) {
          var row = data[rowIndex] || [];
          var rowParts = ['<tr>'];
          
          for (var i = 0; i < maxColsToShow; i++) {
            var cellValue = (row[i] || '').toString();
            // é™åˆ¶å•å…ƒæ ¼å†…å®¹é•¿åº¦
            if (cellValue.length > 50) { // å‡å°‘åˆ°50å­—ç¬¦ï¼Œæå‡æ¸²æŸ“é€Ÿåº¦
              cellValue = cellValue.substring(0, 50) + '...';
            }
            // ç®€åŒ–HTMLï¼Œç§»é™¤titleå±æ€§ä»¥æå‡æ€§èƒ½
            rowParts.push('<td>' + cellValue + '</td>');
          }
          
          if (headers.length > maxColsToShow) {
            rowParts.push('<td style="color:#999;">...</td>');
          }
          rowParts.push('</tr>');
          bodyParts.push(rowParts.join(''));
        }
        
        if (data.length > maxRowsToShow) {
          bodyParts.push('<tr><td colspan="' + maxColsToShow + 
                        '" style="text-align: center; color: #999; padding: 20px;">... çœç•¥ ' + 
                        (data.length - maxRowsToShow) + ' è¡Œï¼Œè¯·ä½¿ç”¨åˆ†é¡µæµè§ˆ</td></tr>');
        }
        
        // ä¸€æ¬¡æ€§è®¾ç½®innerHTMLï¼Œæ¯”å¤šæ¬¡DOMæ“ä½œå¿«å¾ˆå¤š
        var bodyHtml = bodyParts.join('');
        document.getElementById('tableBody').innerHTML = bodyHtml;
        console.log('è¡¨æ ¼æ¸²æŸ“å®Œæˆ');
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        document.getElementById('currentSheetName').textContent = analysis.currentSheet;
        if (analysis.pagination) {
          document.getElementById('totalRows').textContent = analysis.pagination.totalRows;
          document.getElementById('currentPage').textContent = analysis.pagination.currentPage;
          document.getElementById('totalPages').textContent = analysis.pagination.totalPages;
        }
        
        document.getElementById('dataTable').style.display = 'table';
        console.log('æ•°æ®è¡¨æ ¼æ˜¾ç¤ºå®Œæˆ');
      }
      
      function displayPagination(pagination) {
        laypage.render({
          elem: 'pagination',
          count: pagination.totalRows,
          limit: pagination.limit,
          curr: pagination.currentPage,
          layout: ['count', 'prev', 'page', 'next', 'refresh', 'skip'],
          jump: function(obj, first) {
            if (!first) {
              currentPage = obj.curr;
              loadFileData();
            }
          }
        });
      }
      
      window.switchSheet = function(sheetName) {
        if (sheetName === currentSheet) return;
        
        currentSheet = sheetName;
        currentPage = 1; // åˆ‡æ¢å·¥ä½œè¡¨æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ
        loadFileData();
      };
      
      window.refreshData = function() {
        loadFileData();
      };
      
      window.goBack = function() {
        console.log('è¿”å›æŒ‰é’®è¢«ç‚¹å‡»');
        console.log('å½“å‰referrer:', document.referrer);
        
        // ç›´æ¥è·³è½¬åˆ°è¡¨æ ¼ç®¡ç†é¡µé¢ï¼Œé¿å…historyé—®é¢˜
        window.location.href = 'table-management.html';
      };
      
      window.downloadFile = function() {
        if (!currentFileId) return;
        
        var token = userInfo.token || localStorage.getItem('token');
        var downloadUrl = '/api/files/' + currentFileId + '/download';
        
        if (token) {
          // ä½¿ç”¨fetchä¸‹è½½å¹¶å¤„ç†è®¤è¯
          fetch(downloadUrl, {
            headers: {
              'Authorization': 'Bearer ' + token
            }
          })
          .then(response => {
            if (response.ok) {
              return response.blob();
            } else {
              throw new Error('ä¸‹è½½å¤±è´¥: ' + response.status);
            }
          })
          .then(blob => {
            var url = window.URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = ''; // è®©æµè§ˆå™¨æ ¹æ®å“åº”å¤´å†³å®šæ–‡ä»¶å
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            layer.msg('æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', {icon: 1});
          })
          .catch(error => {
            console.error('ä¸‹è½½é”™è¯¯:', error);
            layer.msg('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•', {icon: 2});
          });
        } else {
          layer.msg('è¯·å…ˆç™»å½•', {icon: 2});
        }
      };
      
      function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'block' : 'none';
        document.getElementById('dataTable').style.display = show ? 'none' : 'table';
      }
      
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        var k = 1024;
        var sizes = ['B', 'KB', 'MB', 'GB'];
        var i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
      
      function formatDateTime(dateString) {
        var date = new Date(dateString);
        return date.toLocaleString('zh-CN');
      }
    });
    
    // é€€å‡ºç™»å½•
    function logout() {
      layer.confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ', {icon: 3, title: 'æç¤º'}, function(index){
        localStorage.removeItem('currentUser');
        localStorage.removeItem('token');
        layer.close(index);
        layer.msg('å·²å®‰å…¨é€€å‡ºï¼', {icon: 1}, function(){
          window.location.href = 'login.html';
        });
      });
    }
    
    // åˆ‡æ¢è´¦æˆ·
    function switchAccount() {
      layer.confirm('åˆ‡æ¢è´¦æˆ·å°†é€€å‡ºå½“å‰ç™»å½•ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ', {
        icon: 3, 
        title: 'åˆ‡æ¢è´¦æˆ·',
        btn: ['ç¡®å®š', 'å–æ¶ˆ']
      }, function(index) {
        localStorage.removeItem('currentUser');
        localStorage.removeItem('token');
        layer.close(index);
        layer.msg('æ­£åœ¨åˆ‡æ¢è´¦æˆ·...', {icon: 16, time: 1000}, function(){
          window.location.href = 'login.html';
        });
      });
    }
  </script>
</body>
</html> 