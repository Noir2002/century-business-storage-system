<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>è¡¨æ ¼ç®¡ç† - æ•°æ®ç®¡ç†ç³»ç»Ÿ</title>
  <link href="./src/css/layui.css" rel="stylesheet">
  <link href="./src/css/app-header.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header .layui-nav {
      background: transparent;
    }
    .header .layui-nav .layui-nav-item a {
      color: rgba(255,255,255,0.9);
    }
    .header .layui-nav .layui-nav-item a:hover {
      color: white;
    }
    .header .logo {
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
    }
    
    /* ä¸»å¯¼èˆªæ ·å¼ */
    .main-nav {
      flex: 1;
      display: flex;
      justify-content: center;
      margin: 0 20px;
    }
    .main-nav .layui-nav-item {
      margin: 0 5px;
    }
    .main-nav .layui-nav-item a {
      padding: 0 20px;
      border-radius: 6px;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    .main-nav .layui-nav-item a:hover,
    .main-nav .layui-nav-item.layui-this a {
      background: rgba(255,255,255,0.2);
      color: white;
    }
    .main-nav .layui-nav-item a i {
      margin-right: 6px;
    }
    
    .header .user-info {
      white-space: nowrap;
    }
    
    /* ç”¨æˆ·ä¸‹æ‹‰èœå•æ ·å¼ */
    .user-info .layui-nav-child dd a {
      padding: 10px 15px;
      color: #666;
      transition: all 0.3s ease;
    }
    .user-info .layui-nav-child dd a:hover {
      background: #f8f9fa;
      color: #16baaa;
    }
    .user-info .layui-nav-child dd a i {
      margin-right: 8px;
      font-size: 14px;
    }
    
    .content-wrapper {
      padding: 20px;
    }
    
    .page-header {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .page-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin: 0;
    }
    .page-subtitle {
      color: #666;
      margin-top: 5px;
    }
    .breadcrumb {
      color: #999;
      font-size: 14px;
      margin-top: 10px;
    }
    .breadcrumb a {
      color: #16baaa;
      text-decoration: none;
    }
    
    .filter-panel {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .filter-title {
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }
    
    .action-buttons {
      text-align: right;
      margin-bottom: 15px;
    }
    
    .table-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .table-header {
      padding: 20px;
      border-bottom: 1px solid #f0f0f0;
      background: #fafafa;
    }
    .table-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: #666;
    }
    
    .custom-table {
      width: 100%;
      font-size: 13px;
    }
    .custom-table th {
      background: #f8f9fa;
      font-weight: bold;
      text-align: center;
      padding: 12px 8px;
      border: 1px solid #e6e6e6;
      white-space: nowrap;
    }
    .custom-table td {
      padding: 10px 8px;
      border: 1px solid #e6e6e6;
      text-align: center;
      white-space: nowrap;
    }
    .custom-table tbody tr:hover {
      background: #f8f9fa;
    }
    .editable-cell {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .editable-cell:hover {
      background: #e6f7ff;
    }
    .editing-cell {
      background: #fff1b8;
    }
    
    .sku-column {
      background: #f0f9ff;
      font-weight: bold;
      max-width: 120px;
      word-break: break-all;
    }
    .stock-column {
      background: #f0fff4;
    }
    .sales-column {
      background: #fff7e6;
    }
    .date-column {
      background: #f9f0ff;
    }
    
    .status-low {
      color: #f5222d;
      font-weight: bold;
    }
    .status-warning {
      color: #fa8c16;
      font-weight: bold;
    }
    .status-normal {
      color: #52c41a;
    }
    
    .cell-input {
      width: 100%;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 13px;
    }
    
    .pagination-wrapper {
      padding: 20px;
      text-align: center;
      background: white;
      border-top: 1px solid #f0f0f0;
    }
    
    .modal-content {
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="layui-header header">
    <div class="logo">
      ğŸ“Š æ•°æ®ç®¡ç†ç³»ç»Ÿ
    </div>
    
    <!-- ä¸»å¯¼èˆªæŒ‰é’® -->
    <ul class="layui-nav main-nav">
      <li class="layui-nav-item">
        <a href="dashboard.html">
          <i class="layui-icon layui-icon-home"></i> æ•°æ®ä»ªè¡¨ç›˜
        </a>
      </li>
      <li class="layui-nav-item layui-this">
        <a href="table-management.html">
          <i class="layui-icon layui-icon-table"></i> è¡¨æ ¼ç®¡ç†
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="data-upload.html">
          <i class="layui-icon layui-icon-upload-drag"></i> æ•°æ®å¯¼å…¥
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="arcteryx-data-analysis.html">
          <i class="layui-icon layui-icon-chart"></i> å§‹ç¥–é¸Ÿå¤–ç½‘æ•°æ®åˆ†æ
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="local-database.html">
          <i class="layui-icon layui-icon-database"></i> æœ¬åœ°æ•°æ®åº“
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="tmall-database.html">
          <i class="layui-icon layui-icon-cart"></i> å¤©çŒ«æ•°æ®åº“
        </a>
      </li>
      <li class="layui-nav-item">
        <a href="tmall-order.html">
          <i class="layui-icon layui-icon-list"></i> å¤©çŒ«è®¢å•
        </a>
      </li>
      <li class="layui-nav-item" id="adminOnlyTopNav" style="display: none;">
        <a href="user-management.html">
          <i class="layui-icon layui-icon-username"></i> ç”¨æˆ·ç®¡ç†
        </a>
      </li>
    </ul>
    
    
  </div>
  
  <div class="content-wrapper">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">ğŸ“Š è¡¨æ ¼æ•°æ®ç®¡ç†</h1>
      <p class="page-subtitle">ç®¡ç†æ‚¨çš„SKUåº“å­˜å’Œé”€å”®æ•°æ®</p>
      <div class="breadcrumb">
        <a href="dashboard.html">é¦–é¡µ</a> / è¡¨æ ¼ç®¡ç†
      </div>
    </div>
    
    <!-- ç­›é€‰é¢æ¿ -->
    <div class="filter-panel">
      <div class="filter-title">ğŸ” æ•°æ®ç­›é€‰</div>
      <form class="layui-form" lay-filter="filterForm">
        <div class="layui-row layui-col-space15">
          <div class="layui-col-md3">
            <label class="layui-form-label">SKUæœç´¢</label>
            <div class="layui-input-block">
              <input type="text" name="skuSearch" placeholder="è¾“å…¥SKUç¼–ç " class="layui-input">
            </div>
          </div>
          <div class="layui-col-md3">
            <label class="layui-form-label">åº“å­˜çŠ¶æ€</label>
            <div class="layui-input-block">
              <select name="stockStatus">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="low">åº“å­˜ä¸è¶³</option>
                <option value="warning">åº“å­˜é¢„è­¦</option>
                <option value="normal">åº“å­˜æ­£å¸¸</option>
              </select>
            </div>
          </div>
          <div class="layui-col-md3">
            <label class="layui-form-label">æ—¥æœŸèŒƒå›´</label>
            <div class="layui-input-block">
              <input type="text" name="dateRange" id="dateRange" placeholder="é€‰æ‹©æ—¥æœŸèŒƒå›´" class="layui-input">
            </div>
          </div>
          <div class="layui-col-md3">
            <label class="layui-form-label">æ“ä½œ</label>
            <div class="layui-input-block">
              <button type="button" class="layui-btn layui-btn-normal" onclick="searchData()">
                <i class="layui-icon layui-icon-search"></i> æœç´¢
              </button>
              <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-buttons">
      <button class="layui-btn layui-btn-normal" onclick="importData()" id="importBtn">
        <i class="layui-icon layui-icon-upload"></i> å¯¼å…¥æ•°æ®
      </button>
      <button class="layui-btn layui-btn-warm" onclick="exportData()">
        <i class="layui-icon layui-icon-download-circle"></i> å¯¼å‡ºæ•°æ®
      </button>
      <button class="layui-btn" onclick="addRecord()" id="addBtn">
        <i class="layui-icon layui-icon-add-1"></i> æ–°å¢è®°å½•
      </button>
      <button class="layui-btn layui-btn-danger" onclick="deleteSelected()" id="deleteBtn">
        <i class="layui-icon layui-icon-delete"></i> æ‰¹é‡åˆ é™¤
      </button>
    </div>
    
    <!-- æ–‡ä»¶åˆ—è¡¨å®¹å™¨ -->
    <div class="table-container">
      <div class="table-header">
        <div class="table-stats">
          <span>å…± <strong id="totalRecords">0</strong> ä¸ªæ–‡ä»¶</span>
          <span>å·²é€‰æ‹© <strong id="selectedCount">0</strong> ä¸ª</span>
        </div>
      </div>
      
      <div style="overflow-x: auto;">
        <table class="custom-table" id="fileTable">
          <thead>
            <tr>
              <th><input type="checkbox" lay-skin="primary" id="selectAll"></th>
              <th>æ–‡ä»¶å</th>
              <th>å¤§å°</th>
              <th>å·¥ä½œè¡¨æ•°</th>
              <th>æ•°æ®è¡Œæ•°</th>
              <th>ä¸Šä¼ æ—¶é—´</th>
              <th>ä¸Šä¼ è€…</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 24px;"></i>
                <div style="margin-top: 10px;">æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper">
        <div id="pagination"></div>
      </div>
    </div>
  </div>

  <script src="./src/layui.js"></script>
  <script>
    layui.use(['form', 'layer', 'laydate', 'laypage'], function(){
      var form = layui.form;
      var layer = layui.layer;
      var laydate = layui.laydate;
      var laypage = layui.laypage;
      
      var userInfo = JSON.parse(localStorage.getItem('currentUser') || '{}');
      var fileList = [];
      
      // åˆå§‹åŒ–é¡µé¢
      initPage();
      
      function initPage() {
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (!userInfo.username) {
          layer.msg('è¯·å…ˆç™»å½•ï¼', {icon: 2}, function(){
            window.location.href = 'login.html';
          });
          return;
        }
        
        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
        var cu = document.getElementById('currentUser');
        if (cu) cu.textContent = userInfo.realname || userInfo.username;
        
        // æ ¹æ®è§’è‰²æ˜¾ç¤º/éšè—åŠŸèƒ½
        if (userInfo.role === 'admin') {
          // æ˜¾ç¤ºç®¡ç†å‘˜ä¸“ç”¨å¯¼èˆª
          document.getElementById('adminOnlyTopNav').style.display = 'block';
        } else {
          // æ•°æ®åˆ†æå‘˜éšè—ç¼–è¾‘åŠŸèƒ½
          document.getElementById('importBtn').style.display = 'none';
          document.getElementById('addBtn').style.display = 'none';
          document.getElementById('deleteBtn').style.display = 'none';
        }
        
        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        laydate.render({
          elem: '#dateRange',
          type: 'date',
          range: true
        });
        
        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        loadFileList();
        
        // å…¨é€‰åŠŸèƒ½
        document.getElementById('selectAll').addEventListener('change', function(){
          var checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
          checkboxes.forEach(function(checkbox){
            checkbox.checked = this.checked;
          }.bind(this));
          updateSelectedCount();
        });
      }
      
      function loadFileList() {
        var token = userInfo.token || localStorage.getItem('token');
        var headers = {};
        
        if (token) {
          headers['Authorization'] = 'Bearer ' + token;
        }
        
        fetch('/api/files', {
          headers: headers
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            fileList = data.files;
            renderFileTable();
            updateFileStats();
          } else {
            layer.msg('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ' + data.error, {icon: 2});
            showEmptyState();
          }
        })
        .catch(error => {
          console.error('åŠ è½½é”™è¯¯:', error);
          layer.msg('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', {icon: 2});
          showEmptyState();
        });
      }
      
      function renderFileTable() {
        var tbody = document.getElementById('tableBody');
        var html = '';
        
        if (fileList.length === 0) {
          showEmptyState();
          return;
        }
        
        fileList.forEach(function(file){
          html += '<tr>';
          html += '<td><input type="checkbox" lay-skin="primary" data-file-id="' + file.id + '" onchange="updateSelectedCount()"></td>';
          html += '<td><i class="layui-icon layui-icon-file" style="color: #52c41a; margin-right: 5px;"></i>' + file.originalName + '</td>';
          html += '<td>' + formatFileSize(file.size) + '</td>';
          html += '<td>' + (file.sheetNames ? file.sheetNames.length : '-') + '</td>';
          html += '<td>' + (file.rowCount || '-') + '</td>';
          html += '<td>' + formatDateTime(file.uploadTime) + '</td>';
          html += '<td>' + file.uploadedBy + '</td>';
          html += '<td>';
          
          // æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®ï¼ˆæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ï¼‰
          html += '<button class="layui-btn layui-btn-xs layui-btn-normal" onclick="viewExcelData(' + file.id + ')" title="æŸ¥çœ‹Excelæ•°æ®">';
          html += '<i class="layui-icon layui-icon-table"></i> é«˜çº§æŸ¥çœ‹</button> ';
          
          // ç®€åŒ–ç‰ˆæŸ¥çœ‹å™¨
          html += '<button class="layui-btn layui-btn-xs" onclick="viewExcelDataSimple(' + file.id + ')" title="ç®€åŒ–ç‰ˆæŸ¥çœ‹å™¨">';
          html += '<i class="layui-icon layui-icon-list"></i> ç®€åŒ–æŸ¥çœ‹</button> ';
          
          // ä¸‹è½½æŒ‰é’®
          html += '<button class="layui-btn layui-btn-xs" onclick="downloadFile(' + file.id + ')" title="ä¸‹è½½æ–‡ä»¶">';
          html += '<i class="layui-icon layui-icon-download-circle"></i> ä¸‹è½½</button>';
          
          // ç®¡ç†å‘˜æƒé™æŒ‰é’®
          if (userInfo.role === 'admin') {
            html += ' <button class="layui-btn layui-btn-xs layui-btn-danger" onclick="deleteFile(' + file.id + ')" title="åˆ é™¤æ–‡ä»¶">';
            html += '<i class="layui-icon layui-icon-delete"></i> åˆ é™¤</button>';
          }
          
          html += '</td>';
          html += '</tr>';
        });
        
        tbody.innerHTML = html;
        form.render('checkbox');
      }
      
      function showEmptyState() {
        var tbody = document.getElementById('tableBody');
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #999;">' +
          '<i class="layui-icon layui-icon-file" style="font-size: 48px; color: #ddd; display: block; margin-bottom: 10px;"></i>' +
          '<div>æš‚æ— Excelæ–‡ä»¶</div>' +
          '<div style="margin-top: 10px;"><a href="data-upload.html">ç«‹å³ä¸Šä¼ æ–‡ä»¶</a></div>' +
          '</td></tr>';
      }
      
      function updateFileStats() {
        document.getElementById('totalRecords').textContent = fileList.length;
      }
      
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        var k = 1024;
        var sizes = ['B', 'KB', 'MB', 'GB'];
        var i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
      
      function formatDateTime(dateString) {
        var date = new Date(dateString);
        return date.toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
      
      function getStockStatus(stock) {
        if (stock <= 0) return 'status-low';
        if (stock < 20) return 'status-warning';
        return 'status-normal';
      }
      
      function updateSelectedCount() {
        var selected = document.querySelectorAll('tbody input[type="checkbox"]:checked');
        document.getElementById('selectedCount').textContent = selected.length;
      }
      
      // æœç´¢åŠŸèƒ½
      window.searchData = function() {
        var formData = form.val('filterForm');
        layer.msg('æœç´¢åŠŸèƒ½ï¼š' + JSON.stringify(formData), {icon: 1});
        // è¿™é‡Œå¯ä»¥å®ç°çœŸå®çš„æœç´¢é€»è¾‘
      };
      
      // å•å…ƒæ ¼ç¼–è¾‘
      window.editCell = function(cell, recordId, columnKey) {
        if (userInfo.role !== 'admin') return;
        
        var currentValue = cell.textContent.trim();
        cell.classList.add('editing-cell');
        cell.innerHTML = '<input type="text" class="cell-input" value="' + currentValue + '" onblur="saveCell(this, ' + recordId + ', \'' + columnKey + '\')" onkeypress="handleCellKeypress(event, this, ' + recordId + ', \'' + columnKey + '\')" autofocus>';
        cell.querySelector('.cell-input').focus();
      };
      
      window.saveCell = function(input, recordId, columnKey) {
        var newValue = input.value;
        var cell = input.parentNode;
        cell.classList.remove('editing-cell');
        cell.innerHTML = newValue;
        
        // è¿™é‡Œå¯ä»¥å‘é€AJAXè¯·æ±‚ä¿å­˜æ•°æ®
        layer.msg('æ•°æ®å·²ä¿å­˜', {icon: 1, time: 1000});
      };
      
      window.handleCellKeypress = function(event, input, recordId, columnKey) {
        if (event.key === 'Enter') {
          input.blur();
        }
      };
      
      // Excelæ•°æ®æŸ¥çœ‹å™¨
      window.viewExcelData = function(fileId) {
        window.open('excel-viewer.html?fileId=' + fileId, '_blank');
      };
      
      // ç®€åŒ–ç‰ˆExcelæ•°æ®æŸ¥çœ‹å™¨
      window.viewExcelDataSimple = function(fileId) {
        window.open('simple-excel-viewer.html?fileId=' + fileId, '_blank');
      };
      
      // ä¸‹è½½æ–‡ä»¶
      window.downloadFile = function(fileId) {
        var token = userInfo.token || localStorage.getItem('token');
        var downloadUrl = '/api/files/' + fileId + '/download';
        
        if (token) {
          // ä½¿ç”¨fetchä¸‹è½½å¹¶å¤„ç†è®¤è¯
          fetch(downloadUrl, {
            headers: {
              'Authorization': 'Bearer ' + token
            }
          })
          .then(response => {
            if (response.ok) {
              return response.blob();
            } else {
              throw new Error('ä¸‹è½½å¤±è´¥: ' + response.status);
            }
          })
          .then(blob => {
            var url = window.URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = ''; // è®©æµè§ˆå™¨æ ¹æ®å“åº”å¤´å†³å®šæ–‡ä»¶å
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            layer.msg('æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', {icon: 1});
          })
          .catch(error => {
            console.error('ä¸‹è½½é”™è¯¯:', error);
            layer.msg('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•', {icon: 2});
          });
        } else {
          layer.msg('è¯·å…ˆç™»å½•', {icon: 2});
        }
      };
      
      // åˆ é™¤æ–‡ä»¶
      window.deleteFile = function(fileId) {
        layer.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼', {
          icon: 3, 
          title: 'ç¡®è®¤åˆ é™¤'
        }, function(index) {
          var token = userInfo.token || localStorage.getItem('token');
          var headers = {};
          
          if (token) {
            headers['Authorization'] = 'Bearer ' + token;
          }
          
          fetch('/api/files/' + fileId, {
            method: 'DELETE',
            headers: headers
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              layer.msg('æ–‡ä»¶åˆ é™¤æˆåŠŸï¼', {icon: 1});
              loadFileList(); // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
            } else {
              layer.msg('åˆ é™¤å¤±è´¥: ' + data.error, {icon: 2});
            }
          })
          .catch(error => {
            console.error('åˆ é™¤é”™è¯¯:', error);
            layer.msg('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', {icon: 2});
          });
          
          layer.close(index);
        });
      };
      
      // å¯¼å…¥æ•°æ®
      window.importData = function() {
        window.location.href = 'data-upload.html';
      };
      
      // å¯¼å‡ºæ•°æ®
      window.exportData = function() {
        layer.confirm('ç¡®å®šè¦å¯¼å‡ºå½“å‰æ•°æ®å—ï¼Ÿ', {icon: 3, title: 'ç¡®è®¤å¯¼å‡º'}, function(index){
          layer.msg('æ­£åœ¨å¯¼å‡ºæ•°æ®...', {icon: 16, time: 2000});
          // è¿™é‡Œå¯ä»¥å®ç°çœŸå®çš„å¯¼å‡ºåŠŸèƒ½
          setTimeout(function(){
            layer.msg('å¯¼å‡ºæˆåŠŸï¼', {icon: 1});
          }, 2000);
          layer.close(index);
        });
      };
      
      // æ–°å¢è®°å½•
      window.addRecord = function() {
        layer.open({
          type: 1,
          title: 'â• æ–°å¢è®°å½•',
          area: ['800px', '600px'],
          content: '<div class="modal-content"><p>æ–°å¢è®°å½•è¡¨å•å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p></div>'
        });
      };
      
      // æ‰¹é‡åˆ é™¤
      window.deleteSelected = function() {
        var selected = document.querySelectorAll('tbody input[type="checkbox"]:checked');
        if (selected.length === 0) {
          layer.msg('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®°å½•ï¼', {icon: 2});
          return;
        }
        
        layer.confirm('ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ' + selected.length + ' æ¡è®°å½•å—ï¼Ÿ', {icon: 3, title: 'ç¡®è®¤åˆ é™¤'}, function(index){
          layer.msg('åˆ é™¤æˆåŠŸï¼', {icon: 1});
          renderTable();
          updateSelectedCount();
          layer.close(index);
        });
      };
      
      // ç¼–è¾‘è®°å½•
      window.editRecord = function(id) {
        layer.open({
          type: 1,
          title: 'âœï¸ ç¼–è¾‘è®°å½•',
          area: ['800px', '600px'],
          content: '<div class="modal-content"><p>ç¼–è¾‘è®°å½• ID: ' + id + '</p></div>'
        });
      };
      
      // æŸ¥çœ‹è®°å½•
      window.viewRecord = function(id) {
        layer.open({
          type: 1,
          title: 'ğŸ‘ï¸ æŸ¥çœ‹è®°å½•',
          area: ['800px', '600px'],
          content: '<div class="modal-content"><p>æŸ¥çœ‹è®°å½• ID: ' + id + '</p></div>'
        });
      };
      
      // åˆ é™¤è®°å½•
      window.deleteRecord = function(id) {
        layer.confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ', {icon: 3, title: 'ç¡®è®¤åˆ é™¤'}, function(index){
          layer.msg('åˆ é™¤æˆåŠŸï¼', {icon: 1});
          renderTable();
          layer.close(index);
        });
      };
    });
    
    // é€€å‡ºç™»å½•
          function logout() {
        layer.confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ', {icon: 3, title: 'æç¤º'}, function(index){
          localStorage.removeItem('currentUser');
          layer.close(index);
          layer.msg('å·²å®‰å…¨é€€å‡ºï¼', {icon: 1}, function(){
            window.location.href = 'login.html';
          });
        });
      }
      
      // åˆ‡æ¢è´¦æˆ·
      function switchAccount() {
        layer.confirm('åˆ‡æ¢è´¦æˆ·å°†é€€å‡ºå½“å‰ç™»å½•ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ', {
          icon: 3, 
          title: 'åˆ‡æ¢è´¦æˆ·',
          btn: ['ç¡®å®š', 'å–æ¶ˆ']
        }, function(index) {
          localStorage.removeItem('currentUser');
          layer.close(index);
          layer.msg('æ­£åœ¨åˆ‡æ¢è´¦æˆ·...', {icon: 16, time: 1000}, function(){
            window.location.href = 'login.html';
          });
        });
      }
  </script>
</body>
</html> 