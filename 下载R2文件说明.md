# R2文件下载工具

这个工具可以帮助您从Cloudflare R2存储桶中下载所有的图片和视频文件到本地。

## 功能特点

- ✅ 自动识别图片和视频文件
- ✅ 跳过库存系统文件（arc/、package-sync/等）
- ✅ 自动处理重名文件
- ✅ 显示下载进度和统计信息
- ✅ 支持多种图片和视频格式

## 安装步骤

1. **安装依赖**：
   ```bash
   npm install
   ```

2. **配置R2连接**：
   ```bash
   npm run setup
   ```
   这会创建 `r2-config.js` 文件

3. **编辑配置文件**：
   打开 `r2-config.js` 文件，填入您的R2配置：
   ```javascript
   module.exports = {
     r2: {
       region: 'auto',
       endpoint: 'https://your-account-id.r2.cloudflarestorage.com',
       credentials: {
         accessKeyId: 'your-access-key-id',
         secretAccessKey: 'your-secret-access-key'
       }
     },
     bucketName: 'century-business-system',
     downloadDir: './2025-09-10'
   };
   ```

## 使用方法

运行下载命令：
```bash
npm run download
```

或者直接运行：
```bash
node download-r2-files-improved.js
```

## 配置说明

### R2配置获取方法

1. **登录Cloudflare Dashboard**
2. **进入R2对象存储**
3. **选择您的存储桶**
4. **点击"管理R2 API令牌"**
5. **创建API令牌**，获取：
   - Access Key ID
   - Secret Access Key
   - Account ID（用于构建端点URL）

### 端点URL格式
```
https://<account-id>.r2.cloudflarestorage.com
```

## 支持的文件格式

### 图片格式
- .jpg, .jpeg
- .png
- .gif
- .webp
- .bmp
- .tiff
- .svg

### 视频格式
- .mp4
- .avi
- .mov
- .wmv
- .flv
- .webm
- .mkv
- .m4v

## 输出

所有文件将下载到 `./2025-09-10/` 目录中。

如果遇到重名文件，会自动添加序号（如：`image_1.jpg`、`image_2.jpg`）。

## 注意事项

- 确保有足够的磁盘空间
- 确保网络连接稳定
- 大量文件下载可能需要较长时间
- 工具会自动跳过库存系统文件，只下载图片和视频

## 故障排除

如果遇到问题：

1. **检查R2配置**：确保端点URL、访问密钥正确
2. **检查网络连接**：确保能访问Cloudflare R2
3. **检查权限**：确保API令牌有读取权限
4. **查看错误日志**：工具会显示详细的错误信息

## 示例输出

```
🚀 开始下载R2中的所有图片和视频文件...
📁 下载目录: /path/to/2025-09-10
🪣 存储桶: century-business-system
🔗 端点: https://your-account-id.r2.cloudflarestorage.com

📄 正在处理第 1 页...
   找到 1000 个对象
✅ 下载成功: package/2025-09/2025-09-01/2025-09-01_0441/1756735814490_0_ny0u_IMG_4002.jpeg -> 1756735814490_0_ny0u_IMG_4002.jpeg
✅ 下载成功: package/2025-09/2025-09-01/2025-09-01_0441/1756735819119_1_6ytw_IMG_4003.jpeg -> 1756735819119_1_6ytw_IMG_4003.jpeg
...

🎉 下载完成!
==================================================
📊 统计信息:
   总文件数: 135
   成功下载: 135
   下载失败: 0
   跳过文件: 0
   耗时: 45 秒
   下载目录: /path/to/2025-09-10
==================================================
```
